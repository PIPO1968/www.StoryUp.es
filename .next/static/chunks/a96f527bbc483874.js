(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,56095,e=>{"use strict";var t=e.i(43476),s=e.i(71645);let a=({nick:e,className:a})=>{let[r,i]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let t=()=>{if(e){let t=localStorage.getItem(`premium_${e}`);if(t)try{let e=JSON.parse(t),s=new Date(e.expiracion)>new Date;i(s)}catch(e){i(!1)}else i(!1)}};t();let s=e=>{(e.key?.startsWith("premium_")||null===e.key)&&t()},a=s=>{s.detail.nick===e&&t()};return window.addEventListener("storage",s),window.addEventListener("premiumUpdate",a),()=>{window.removeEventListener("storage",s),window.removeEventListener("premiumUpdate",a)}},[e]);let l=(e||"").trim().toLowerCase();return e&&"anonimo"!==l&&"an贸nimo"!==l?(0,t.jsxs)("a",{href:`/perfil/${encodeURIComponent(e)}`,className:a||"text-blue-600 underline hover:text-blue-800",title:`Ver perfil de ${e}${r?" (Usuario Premium)":""}`,children:[e,r&&(0,t.jsx)("span",{className:"ml-1 inline-flex items-center",children:(0,t.jsx)("span",{className:"bg-gradient-to-r from-sky-100 to-blue-100 text-amber-900 text-xs px-2 py-1 rounded-full font-bold shadow-md border border-sky-300",title:"Usuario Premium",children:""})})]}):(0,t.jsx)("span",{className:a||"text-gray-500",children:e||"(sin nick)"})};function r(e,s){return(0,t.jsx)(a,{nick:e,className:s})}e.s(["renderNick",()=>r],56095)},18566,(e,t,s)=>{t.exports=e.r(76562)},76179,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(56095),r=e.i(18566);function i(){let e=(0,r.useParams)(),i=e?.id,[l,o]=(0,s.useState)(null),[n,c]=(0,s.useState)(""),[d,m]=(0,s.useState)([]),[u,g]=(0,s.useState)(0),[p,h]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{if(i){let e=localStorage.getItem("historias"),t=(e?JSON.parse(e):[]).find(e=>e.id==i);if(t){o(t),g(t.likes||0),m(t.comentarios||[]);let e=localStorage.getItem("user"),s="";if(e)try{let t=JSON.parse(e);s=t.nick||t.nombre||t.usuario||e}catch{console.error("Error al parsear el usuario desde localStorage:",e),s=""}let a=t.likedBy||[];console.log("Usuario actual:",s),console.log("Usuarios que dieron like:",a),h(a.includes(s))}else console.warn("No se encontr贸 la historia con el ID especificado en localStorage.")}},[i]),l)?(0,t.jsx)("div",{className:"min-h-screen bg-green-100 p-8",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 max-w-2xl mx-auto",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-2",children:l.titulo}),(0,t.jsxs)("div",{className:"mb-2 text-gray-700",children:["Por: ",(0,a.renderNick)(l.autor)," | ",l.fecha]}),l.imagen&&(0,t.jsx)("img",{src:l.imagen,alt:"Imagen",className:"mb-4 max-h-64 rounded"}),(0,t.jsx)("div",{className:"border rounded p-4 mb-4 bg-gray-50",dangerouslySetInnerHTML:{__html:l.contenido}}),(0,t.jsx)("div",{className:"flex items-center gap-4 mb-4",children:(0,t.jsx)("button",{className:`font-bold py-2 px-4 rounded ${p?"bg-gray-400":"bg-pink-500 hover:bg-pink-600 text-white"}`,onClick:()=>{if(l){let e=localStorage.getItem("user"),t="";if(e)try{let s=JSON.parse(e);t=s.nick||s.nombre||s.usuario||e}catch{console.error("Error al parsear el usuario desde localStorage:",e),t=""}let s=localStorage.getItem("historias"),a=s?JSON.parse(s):[],r=a.findIndex(e=>e.id==l.id);if(-1!==r){let e=a[r].likedBy||[],s=e.includes(t),i=0;s?(e=e.filter(e=>e!==t),a[r].likedBy=e,a[r].likes=Math.max((a[r].likes||1)-1,0),g(a[r].likes),h(!1),i=-1):(e.push(t),a[r].likedBy=e,a[r].likes=(a[r].likes||0)+1,g(a[r].likes),h(!0),i=1),localStorage.setItem("historias",JSON.stringify(a));let l=a[r].autor,o=localStorage.getItem("users");if(o&&l){let e=JSON.parse(o),t=e.findIndex(e=>e.nick===l);if(-1!==t){let s=(e[t].likes||0)+i;e[t].likes=s,localStorage.setItem("users",JSON.stringify(e));let a=localStorage.getItem("user");if(a){let e=JSON.parse(a);e.nick===l&&(e.likes=s,localStorage.setItem("user",JSON.stringify(e)),window.dispatchEvent(new CustomEvent("profileUpdate",{detail:{nick:l,field:"likes",value:s}})))}}}}else console.warn("No se encontr贸 la historia con el ID especificado para actualizar en localStorage.")}},children:p?` (${u})`:`わ Like (${0===u?"0":u})`})}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h2",{className:"font-bold mb-2",children:"Comentarios"}),(0,t.jsx)("ul",{className:"mb-2",children:d.slice(-5).map((e,s)=>(0,t.jsxs)("li",{className:"border-b py-1 text-gray-800",children:[(0,t.jsx)("span",{children:e.texto}),(0,t.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:e.fecha})]},s))}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"text",value:n,onChange:e=>c(e.target.value),placeholder:"Escribe un comentario...",className:"border rounded px-2 py-1 flex-1"}),(0,t.jsx)("button",{className:"bg-green-500 hover:bg-green-600 text-white font-bold px-4 rounded",onClick:()=>{if(!n.trim())return;let e=localStorage.getItem("usuarioActual"),t="";if(e)try{let s=JSON.parse(e);t=s.nick||s.nombre||s.usuario||e}catch{t=e}let s=localStorage.getItem("historias"),a=s?JSON.parse(s):[],r=a.findIndex(e=>e.id==l.id);if(-1!==r){let e=a[r].comentarios||[];if(e.some(e=>e.usuario===t))console.log("El usuario ya coment贸 en esta historia.");else{let s={usuario:t,texto:n,fecha:new Date().toLocaleString()};e.push(s),a[r].comentarios=e,m(e),c(""),((e,t)=>{let s=localStorage.getItem("users");if(s){let a=JSON.parse(s),r=a.findIndex(t=>t.nick===e);if(-1!==r){let s=a[r][t]||0;"number"==typeof s&&(a[r][t]=s+1,localStorage.setItem("users",JSON.stringify(a)),window.dispatchEvent(new CustomEvent("profileUpdate",{detail:{nick:e,field:t,value:a[r][t]}})))}}})(l.autor,"comentariosRecibidos"),localStorage.setItem("historias",JSON.stringify(a)),o(a[r]),console.log("Estado de comentarios despu茅s de agregar uno nuevo:",e)}}},children:"Comentar"})]})]})]})}):(0,t.jsx)("div",{className:"min-h-screen bg-green-100 p-8",children:"Cargando historia..."})}e.s(["default",()=>i])}]);