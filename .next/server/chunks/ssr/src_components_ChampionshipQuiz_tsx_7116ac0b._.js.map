{"version":3,"sources":["turbopack:///[project]/src/components/ChampionshipQuiz.tsx"],"sourcesContent":["import React from \"react\";\r\n\r\ninterface ChampionshipQuizProps {\r\n    userGrade: number;\r\n    userSchool: string;\r\n}\r\n\r\nconst ChampionshipQuiz: React.FC<ChampionshipQuizProps> = ({ userGrade, userSchool }) => {\r\n    const [preguntaActual, setPreguntaActual] = React.useState<string>(\"\");\r\n    const [respuestaCorrecta, setRespuestaCorrecta] = React.useState<string>(\"\");\r\n    const [respuestaUsuario, setRespuestaUsuario] = React.useState<string>(\"\");\r\n    const [feedback, setFeedback] = React.useState<string>(\"\");\r\n    const [preguntasUsadas, setPreguntasUsadas] = React.useState<string[]>([]);\r\n    const [timeLeft, setTimeLeft] = React.useState<number>(300); // 5 minutos\r\n    const [bloqueado, setBloqueado] = React.useState<boolean>(false);\r\n\r\n    React.useEffect(() => {\r\n        if (!preguntaActual || bloqueado) return;\r\n        if (timeLeft === 0) {\r\n            setBloqueado(true);\r\n            setFeedback(\"‚è∞ Tiempo agotado. No puedes responder esta pregunta. -3 likes\");\r\n            // Aqu√≠ podr√≠as actualizar los likes en localStorage si lo deseas\r\n            return;\r\n        }\r\n        const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\r\n        return () => clearTimeout(timer);\r\n    }, [timeLeft, preguntaActual, bloqueado]);\r\n    // Cargar preguntas de campeonato seg√∫n el curso\r\n    let preguntas: any[] = [];\r\n    try {\r\n        preguntas = require(`../questions/campeonato-${userGrade}primaria.json`);\r\n    } catch {\r\n        preguntas = [];\r\n    }\r\n\r\n    function generarPregunta() {\r\n        if (preguntasUsadas.length >= 25) {\r\n            setPreguntaActual(\"\");\r\n            setRespuestaCorrecta(\"\");\r\n            setFeedback(\"¬°Has completado las 25 preguntas del campeonato!\");\r\n            setBloqueado(true);\r\n\r\n            // Calcular estad√≠sticas de la sesi√≥n\r\n            const userStr = typeof window !== \"undefined\" ? localStorage.getItem(\"user\") : null;\r\n            let nick = \"\";\r\n            let centro = \"\";\r\n            let curso = \"\";\r\n            if (userStr) {\r\n                const userObj = JSON.parse(userStr);\r\n                nick = userObj.nick;\r\n                centro = userObj.centro;\r\n                curso = userObj.curso;\r\n            }\r\n            // (Ya declaradas arriba)\r\n\r\n            // Recuperar respuestas y likes\r\n            const respuestasStr = localStorage.getItem(`respuestas_campeonato_${nick}`);\r\n            let respuestasArr = respuestasStr ? JSON.parse(respuestasStr) : [];\r\n            // Contar acertadas y falladas de la sesi√≥n\r\n            const acertadasSesion = respuestasArr.filter((r: any) => r.correcta).length;\r\n            const falladasSesion = respuestasArr.filter((r: any) => !r.correcta).length;\r\n            const likesSesion = respuestasArr.reduce((sum: number, r: any) => sum + (r.likes || 0), 0);\r\n            // Temporada actual: formato tYYYY (declarar antes de cualquier uso)\r\n            const now = new Date();\r\n            let temporada = now.getFullYear();\r\n            if (now.getMonth() + 1 >= 10) temporada += 1;\r\n            const temporadaKey = `t${temporada}`;\r\n            // Solo se considera ganada si acierta m√°s de 12\r\n            const ganadoSesion = acertadasSesion > 12 ? 1 : 0;\r\n            const perdidoSesion = acertadasSesion <= 12 ? 1 : 0;\r\n\r\n            // Sumar acumulado de la temporada\r\n            const keyIndividual = `campeonato_individual_${temporadaKey}`;\r\n            let tablaIndividual: Record<string, any> = {};\r\n            try { tablaIndividual = JSON.parse(localStorage.getItem(keyIndividual) || '{}'); } catch { tablaIndividual = {}; }\r\n            let acertadas = acertadasSesion;\r\n            let falladas = falladasSesion;\r\n            let likes = likesSesion;\r\n            let ganado = ganadoSesion;\r\n            let perdido = perdidoSesion;\r\n            if (tablaIndividual[nick]) {\r\n                acertadas += tablaIndividual[nick].acertadas || 0;\r\n                falladas += tablaIndividual[nick].falladas || 0;\r\n                likes += tablaIndividual[nick].likes || 0;\r\n                ganado += tablaIndividual[nick].ganado || 0;\r\n                perdido += tablaIndividual[nick].perdido || 0;\r\n            }\r\n\r\n            // (Ya declaradas arriba)\r\n\r\n            // Guardar datos seg√∫n tipo de usuario\r\n            if (userStr) {\r\n                const userObj = JSON.parse(userStr);\r\n                // Guardar tablaIndividual para todos los tipos\r\n                tablaIndividual[nick] = {\r\n                    centro,\r\n                    curso,\r\n                    acertadas,\r\n                    falladas,\r\n                    likes,\r\n                    ganado,\r\n                    perdido,\r\n                    fecha: now.toISOString()\r\n                };\r\n                localStorage.setItem(keyIndividual, JSON.stringify(tablaIndividual));\r\n                // Si ha superado la competici√≥n, sumar competicionesSuperadas para cualquier tipo de usuario\r\n                if (ganadoSesion === 1) {\r\n                    userObj.competicionesSuperadas = (userObj.competicionesSuperadas || 0) + 1;\r\n                    localStorage.setItem(\"user\", JSON.stringify(userObj));\r\n                    let usersArr = [];\r\n                    try { usersArr = JSON.parse(localStorage.getItem(\"users\") || \"[]\"); } catch { usersArr = []; }\r\n                    const nickActual = (userObj.nick || \"\").toLowerCase().replace(/\\s+/g, \"\");\r\n                    let actualizado = false;\r\n                    usersArr = usersArr.map((u: any) => {\r\n                        const nickU = (u.nick || \"\").toLowerCase().replace(/\\s+/g, \"\");\r\n                        if (nickU === nickActual) {\r\n                            actualizado = true;\r\n                            return { ...u, ...userObj };\r\n                        }\r\n                        return u;\r\n                    });\r\n                    if (!actualizado) usersArr.push(userObj);\r\n                    localStorage.setItem(\"users\", JSON.stringify(usersArr));\r\n                    // Emitir evento para refrescar perfil y estad√≠sticas\r\n                    window.dispatchEvent(new Event('profileUpdate'));\r\n                    window.dispatchEvent(new Event('storage'));\r\n                }\r\n            }\r\n\r\n            // Guardar datos CENTROS\r\n            const keyCentros = `campeonato_centros_${temporadaKey}`;\r\n            let tablaCentros: Record<string, any> = {};\r\n            try { tablaCentros = JSON.parse(localStorage.getItem(keyCentros) || '{}'); } catch { tablaCentros = {}; }\r\n            if (centro) {\r\n                if (!tablaCentros[centro]) tablaCentros[centro] = { ganados: 0, perdidos: 0, preguntasAcertadas: 0, preguntasFalladas: 0, likes: 0 };\r\n                tablaCentros[centro].ganados += ganado;\r\n                tablaCentros[centro].perdidos += perdido;\r\n                tablaCentros[centro].preguntasAcertadas += acertadas;\r\n                tablaCentros[centro].preguntasFalladas += falladas;\r\n                tablaCentros[centro].likes += likes;\r\n            }\r\n            localStorage.setItem(keyCentros, JSON.stringify(tablaCentros));\r\n\r\n            // Guardar datos DOCENTES\r\n            const keyDocentes = `campeonato_docentes_${temporadaKey}`;\r\n            let tablaDocentes: Record<string, any> = {};\r\n            try { tablaDocentes = JSON.parse(localStorage.getItem(keyDocentes) || '{}'); } catch { tablaDocentes = {}; }\r\n            if (userStr) {\r\n                const userObj = JSON.parse(userStr);\r\n                if (userObj.tipo === \"Docente\") {\r\n                    // Normalizar nick para evitar problemas de coincidencia\r\n                    const nickDocente = (userObj.nick || \"\").toLowerCase().replace(/\\s+/g, \"\");\r\n                    if (!tablaDocentes[nickDocente]) tablaDocentes[nickDocente] = { ganados: 0, perdidos: 0, preguntasAcertadas: 0, preguntasFalladas: 0, likes: 0 };\r\n                    tablaDocentes[nickDocente].ganados += ganado;\r\n                    tablaDocentes[nickDocente].perdidos += perdido;\r\n                    tablaDocentes[nickDocente].preguntasAcertadas += acertadas;\r\n                    tablaDocentes[nickDocente].preguntasFalladas += falladas;\r\n                    tablaDocentes[nickDocente].likes += likes;\r\n                }\r\n            }\r\n            localStorage.setItem(keyDocentes, JSON.stringify(tablaDocentes));\r\n            // Guardar tambi√©n en el perfil del usuario\r\n            if (userStr) {\r\n                const userObj = JSON.parse(userStr);\r\n                userObj.ganados = (userObj.ganados || 0) + ganado;\r\n                userObj.perdidos = (userObj.perdidos || 0) + perdido;\r\n                userObj.respuestasAcertadas = (userObj.respuestasAcertadas || 0) + acertadas;\r\n                userObj.preguntasFalladas = (userObj.preguntasFalladas || 0) + falladas;\r\n                // Sumar likes positivos y negativos\r\n                userObj.likes = (userObj.likes || 0) + likes;\r\n                localStorage.setItem(\"user\", JSON.stringify(userObj));\r\n                // Actualizar tambi√©n el array 'users' para que el perfil est√© sincronizado\r\n                let usersArr = [];\r\n                try { usersArr = JSON.parse(localStorage.getItem(\"users\") || \"[]\"); } catch { usersArr = []; }\r\n                // Buscar por nick normalizado\r\n                const nickActual = (userObj.nick || \"\").toLowerCase().replace(/\\s+/g, \"\");\r\n                let actualizado = false;\r\n                usersArr = usersArr.map((u: any) => {\r\n                    const nickU = (u.nick || \"\").toLowerCase().replace(/\\s+/g, \"\");\r\n                    if (nickU === nickActual) {\r\n                        actualizado = true;\r\n                        return { ...u, ...userObj };\r\n                    }\r\n                    return u;\r\n                });\r\n                // Si no estaba, lo a√±adimos\r\n                if (!actualizado) usersArr.push(userObj);\r\n                localStorage.setItem(\"users\", JSON.stringify(usersArr));\r\n            }\r\n            return;\r\n        }\r\n        setTimeLeft(300);\r\n        setBloqueado(false);\r\n        const restantes = preguntas.filter((p: any) => !preguntasUsadas.includes(p.pregunta));\r\n        if (restantes.length === 0) {\r\n            setPreguntaActual(\"\");\r\n            setRespuestaCorrecta(\"\");\r\n            setFeedback(\"¬°No hay m√°s preguntas disponibles en el banco!\");\r\n            setBloqueado(true);\r\n            return;\r\n        }\r\n        const random = Math.floor(Math.random() * restantes.length);\r\n        setPreguntaActual(restantes[random].pregunta);\r\n        setRespuestaCorrecta(restantes[random].respuesta);\r\n        setRespuestaUsuario(\"\");\r\n        setFeedback(\"\");\r\n        setPreguntasUsadas([...preguntasUsadas, restantes[random].pregunta]);\r\n    }\r\n\r\n    function comprobarRespuesta() {\r\n        // Normalizar para comparar respuestas\r\n        function normalizar(str: string) {\r\n            return str.toLowerCase().normalize(\"NFD\").replace(/\\p{Diacritic}/gu, \"\").replace(/\\s+/g, \"\").trim();\r\n        }\r\n        if (bloqueado) return;\r\n        const esCorrecta = normalizar(respuestaUsuario) === normalizar(respuestaCorrecta);\r\n        setBloqueado(true);\r\n        let likesDelta = 0;\r\n        if (esCorrecta) {\r\n            setFeedback(\"¬°Correcto! üéâ\");\r\n            likesDelta = timeLeft > 120 ? 2 : 1;\r\n        } else {\r\n            setFeedback(`Incorrecto. La respuesta era: ${respuestaCorrecta}`);\r\n            likesDelta = timeLeft > 120 ? -1 : -2;\r\n        }\r\n        if (typeof window !== \"undefined\") {\r\n            const userStr = localStorage.getItem(\"user\");\r\n            if (userStr) {\r\n                const userObj = JSON.parse(userStr);\r\n                userObj.likes = (userObj.likes || 0) + likesDelta;\r\n                localStorage.setItem(\"user\", JSON.stringify(userObj));\r\n\r\n                // Guardar respuesta en el historial de campeonato\r\n                const respuestasKey = `respuestas_campeonato_${userObj.nick}`;\r\n                let respuestasArr = [];\r\n                try { respuestasArr = JSON.parse(localStorage.getItem(respuestasKey) || '[]'); } catch { respuestasArr = []; }\r\n                respuestasArr.push({\r\n                    pregunta: preguntaActual,\r\n                    respuestaUsuario,\r\n                    respuestaCorrecta,\r\n                    correcta: esCorrecta,\r\n                    tiempo: timeLeft,\r\n                    likes: likesDelta\r\n                });\r\n                localStorage.setItem(respuestasKey, JSON.stringify(respuestasArr));\r\n            }\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"p-4 bg-yellow-100 rounded-lg\">\r\n            <h2 className=\"text-xl font-bold mb-2\">Modo Campeonato</h2>\r\n            <p>Curso seleccionado: {userGrade}¬∫ Primaria</p>\r\n            <p>Centro escolar: {userSchool || \"No especificado\"}</p>\r\n            <button className=\"bg-blue-500 text-white px-4 py-2 rounded mt-2\" onClick={generarPregunta}>\r\n                Generar pregunta de campeonato\r\n            </button>\r\n            {preguntaActual && (\r\n                <div className=\"mt-4\">\r\n                    <div className=\"font-semibold mb-2\">{preguntaActual}</div>\r\n                    <div className=\"font-bold text-lg mb-2\">‚è∞ Tiempo: {Math.floor(timeLeft / 60)}:{(timeLeft % 60).toString().padStart(2, '0')} min</div>\r\n                    <input\r\n                        type=\"text\"\r\n                        className=\"border rounded px-2 py-1 w-full mb-2\"\r\n                        value={respuestaUsuario}\r\n                        onChange={e => setRespuestaUsuario(e.target.value)}\r\n                        placeholder=\"Escribe tu respuesta aqu√≠\"\r\n                        disabled={bloqueado}\r\n                    />\r\n                    <button className=\"bg-green-500 text-white px-4 py-2 rounded\" onClick={comprobarRespuesta} disabled={bloqueado}>\r\n                        Enviar respuesta\r\n                    </button>\r\n                    {feedback && <div className=\"mt-2 font-bold\">{feedback}</div>}\r\n                </div>\r\n            )}\r\n            {feedback && !preguntaActual && <div className=\"mt-2 font-bold text-red-600\">{feedback}</div>}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ChampionshipQuiz;\r\n"],"names":[],"mappings":"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"}