{"version":3,"sources":["turbopack:///[project]/src/components/ChampionshipQuiz.tsx"],"sourcesContent":["import React from \"react\";\r\n\r\ninterface ChampionshipQuizProps {\r\n    userGrade: number;\r\n    userSchool: string;\r\n}\r\n\r\nconst ChampionshipQuiz: React.FC<ChampionshipQuizProps> = ({ userGrade, userSchool }) => {\r\n    const [preguntaActual, setPreguntaActual] = React.useState<string>(\"\");\r\n    const [respuestaCorrecta, setRespuestaCorrecta] = React.useState<string>(\"\");\r\n    const [respuestaUsuario, setRespuestaUsuario] = React.useState<string>(\"\");\r\n    const [feedback, setFeedback] = React.useState<string>(\"\");\r\n    const [preguntasUsadas, setPreguntasUsadas] = React.useState<string[]>([]);\r\n    const [timeLeft, setTimeLeft] = React.useState<number>(300); // 5 minutos\r\n    const [bloqueado, setBloqueado] = React.useState<boolean>(false);\r\n    const [currentUser, setCurrentUser] = React.useState<any>(null);\r\n    const [sessionResponses, setSessionResponses] = React.useState<any[]>([]);\r\n\r\n    // Cargar usuario actual al montar el componente\r\n    React.useEffect(() => {\r\n        const loadUser = async () => {\r\n            try {\r\n                const response = await fetch('/api/auth/me');\r\n                if (response.ok) {\r\n                    const user = await response.json();\r\n                    setCurrentUser(user);\r\n                }\r\n            } catch (error) {\r\n                console.error('Error loading user:', error);\r\n            }\r\n        };\r\n        loadUser();\r\n    }, []);\r\n\r\n    // Funci√≥n para actualizar likes del usuario\r\n    const updateUserLikes = async (likesDelta: number) => {\r\n        if (!currentUser) return;\r\n        try {\r\n            const response = await fetch('/api/user/update-likes', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ likesDelta })\r\n            });\r\n            if (response.ok) {\r\n                const updatedUser = await response.json();\r\n                setCurrentUser(updatedUser);\r\n                // Emitir evento para refrescar perfil\r\n                window.dispatchEvent(new Event('profileUpdate'));\r\n            }\r\n        } catch (error) {\r\n            console.error('Error updating likes:', error);\r\n        }\r\n    };\r\n\r\n    // Funci√≥n para actualizar estad√≠sticas de campeonato\r\n    const updateChampionshipStats = async (stats: any) => {\r\n        try {\r\n            const response = await fetch('/api/stats/championship', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(stats)\r\n            });\r\n            if (!response.ok) {\r\n                console.error('Error updating championship stats');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error updating championship stats:', error);\r\n        }\r\n    };\r\n\r\n    React.useEffect(() => {\r\n        if (!preguntaActual || bloqueado) return;\r\n        if (timeLeft === 0) {\r\n            setBloqueado(true);\r\n            setFeedback(\"‚è∞ Tiempo agotado. No puedes responder esta pregunta. -3 likes\");\r\n            updateUserLikes(-3);\r\n            return;\r\n        }\r\n        const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\r\n        return () => clearTimeout(timer);\r\n    }, [timeLeft, preguntaActual, bloqueado]);\r\n    // Cargar preguntas de campeonato seg√∫n el curso\r\n    let preguntas: any[] = [];\r\n    try {\r\n        preguntas = require(`../questions/campeonato-${userGrade}primaria.json`);\r\n    } catch {\r\n        preguntas = [];\r\n    }\r\n\r\n    function generarPregunta() {\r\n        if (preguntasUsadas.length >= 25) {\r\n            setPreguntaActual(\"\");\r\n            setRespuestaCorrecta(\"\");\r\n            setFeedback(\"¬°Has completado las 25 preguntas del campeonato!\");\r\n            setBloqueado(true);\r\n\r\n            // Calcular estad√≠sticas de la sesi√≥n y enviar a API\r\n            if (currentUser) {\r\n                const now = new Date();\r\n                let temporada = now.getFullYear();\r\n                if (now.getMonth() + 1 >= 10) temporada += 1;\r\n                const temporadaKey = `t${temporada}`;\r\n\r\n                // Calcular de las respuestas de la sesi√≥n\r\n                const acertadasSesion = sessionResponses.filter((r: any) => r.correcta).length;\r\n                const falladasSesion = sessionResponses.filter((r: any) => !r.correcta).length;\r\n                const likesSesion = sessionResponses.reduce((sum: number, r: any) => sum + (r.likes || 0), 0);\r\n                const ganadoSesion = acertadasSesion > 12 ? 1 : 0;\r\n                const perdidoSesion = acertadasSesion <= 12 ? 1 : 0;\r\n\r\n                const stats = {\r\n                    nick: currentUser.nick,\r\n                    centro: currentUser.centro,\r\n                    curso: currentUser.curso,\r\n                    temporada: temporadaKey,\r\n                    acertadas: acertadasSesion,\r\n                    falladas: falladasSesion,\r\n                    likes: likesSesion,\r\n                    ganado: ganadoSesion,\r\n                    perdido: perdidoSesion,\r\n                    tipo: currentUser.tipo\r\n                };\r\n\r\n                updateChampionshipStats(stats);\r\n\r\n                // Resetear respuestas de sesi√≥n para pr√≥xima partida\r\n                setSessionResponses([]);\r\n            }\r\n            return;\r\n        }\r\n        setTimeLeft(300);\r\n        setBloqueado(false);\r\n        const restantes = preguntas.filter((p: any) => !preguntasUsadas.includes(p.pregunta));\r\n        if (restantes.length === 0) {\r\n            setPreguntaActual(\"\");\r\n            setRespuestaCorrecta(\"\");\r\n            setFeedback(\"¬°No hay m√°s preguntas disponibles en el banco!\");\r\n            setBloqueado(true);\r\n            return;\r\n        }\r\n        const random = Math.floor(Math.random() * restantes.length);\r\n        setPreguntaActual(restantes[random].pregunta);\r\n        setRespuestaCorrecta(restantes[random].respuesta);\r\n        setRespuestaUsuario(\"\");\r\n        setFeedback(\"\");\r\n        setPreguntasUsadas([...preguntasUsadas, restantes[random].pregunta]);\r\n    }\r\n\r\n    function comprobarRespuesta() {\r\n        // Normalizar para comparar respuestas\r\n        function normalizar(str: string) {\r\n            return str.toLowerCase().normalize(\"NFD\").replace(/\\p{Diacritic}/gu, \"\").replace(/\\s+/g, \"\").trim();\r\n        }\r\n        if (bloqueado) return;\r\n        const esCorrecta = normalizar(respuestaUsuario) === normalizar(respuestaCorrecta);\r\n        setBloqueado(true);\r\n        let likesDelta = 0;\r\n        if (esCorrecta) {\r\n            setFeedback(\"¬°Correcto! üéâ\");\r\n            likesDelta = timeLeft > 120 ? 2 : 1;\r\n        } else {\r\n            setFeedback(`Incorrecto. La respuesta era: ${respuestaCorrecta}`);\r\n            likesDelta = timeLeft > 120 ? -1 : -2;\r\n        }\r\n\r\n        // Actualizar likes\r\n        updateUserLikes(likesDelta);\r\n\r\n        // Guardar respuesta en el historial de sesi√≥n\r\n        const respuesta = {\r\n            pregunta: preguntaActual,\r\n            respuestaUsuario,\r\n            respuestaCorrecta,\r\n            correcta: esCorrecta,\r\n            tiempo: timeLeft,\r\n            likes: likesDelta\r\n        };\r\n        setSessionResponses(prev => [...prev, respuesta]);\r\n    }\r\n\r\n    return (\r\n        <div className=\"p-4 bg-yellow-100 rounded-lg\">\r\n            <h2 className=\"text-xl font-bold mb-2\">Modo Campeonato</h2>\r\n            <p>Curso seleccionado: {userGrade}¬∫ Primaria</p>\r\n            <p>Centro escolar: {userSchool || \"No especificado\"}</p>\r\n            <button className=\"bg-blue-500 text-white px-4 py-2 rounded mt-2\" onClick={generarPregunta}>\r\n                Generar pregunta de campeonato\r\n            </button>\r\n            {preguntaActual && (\r\n                <div className=\"mt-4\">\r\n                    <div className=\"font-semibold mb-2\">{preguntaActual}</div>\r\n                    <div className=\"font-bold text-lg mb-2\">‚è∞ Tiempo: {Math.floor(timeLeft / 60)}:{(timeLeft % 60).toString().padStart(2, '0')} min</div>\r\n                    <input\r\n                        type=\"text\"\r\n                        className=\"border rounded px-2 py-1 w-full mb-2\"\r\n                        value={respuestaUsuario}\r\n                        onChange={e => setRespuestaUsuario(e.target.value)}\r\n                        placeholder=\"Escribe tu respuesta aqu√≠\"\r\n                        disabled={bloqueado}\r\n                    />\r\n                    <button className=\"bg-green-500 text-white px-4 py-2 rounded\" onClick={comprobarRespuesta} disabled={bloqueado}>\r\n                        Enviar respuesta\r\n                    </button>\r\n                    {feedback && <div className=\"mt-2 font-bold\">{feedback}</div>}\r\n                </div>\r\n            )}\r\n            {feedback && !preguntaActual && <div className=\"mt-2 font-bold text-red-600\">{feedback}</div>}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ChampionshipQuiz;\r\n"],"names":[],"mappings":"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"}