{"version":3,"sources":["turbopack:///[project]/src/app/crea-historia/page.tsx"],"sourcesContent":["\"use client\";\r\nimport React, { useRef, useState } from \"react\";\r\nexport default function CreaHistoria() {\r\n    const [titulo, setTitulo] = useState(\"\");\r\n    const [contenido, setContenido] = useState(\"\");\r\n    const [texto, setTexto] = useState(\"\");\r\n    const [imagen, setImagen] = useState<string | null>(null);\r\n    const [anonimo, setAnonimo] = useState(false);\r\n    const [esConcurso, setEsConcurso] = useState(false);\r\n    const [numConcurso, setNumConcurso] = useState(\"\");\r\n    const [showProhibitedPopup, setShowProhibitedPopup] = useState(false);\r\n    const [palabrasDetectadas, setPalabrasDetectadas] = useState<string[]>([]);\r\n    const textareaRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n    // Funciones para formato\r\n    const aplicarFormato = (formato: \"bold\" | \"underline\") => {\r\n        const textarea = textareaRef.current;\r\n        if (!textarea) return;\r\n        const start = textarea.selectionStart;\r\n        const end = textarea.selectionEnd;\r\n        const texto = contenido;\r\n        let nuevoTexto = texto;\r\n        if (formato === \"bold\") {\r\n            nuevoTexto = texto.slice(0, start) + \"<b>\" + texto.slice(start, end) + \"</b>\" + texto.slice(end);\r\n        } else if (formato === \"underline\") {\r\n            nuevoTexto = texto.slice(0, start) + \"<u>\" + texto.slice(start, end) + \"</u>\" + texto.slice(end);\r\n        }\r\n        setContenido(nuevoTexto);\r\n    };\r\n\r\n    // Subida de imagen\r\n    const handleImagen = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (file) {\r\n            const reader = new FileReader();\r\n            reader.onload = () => {\r\n                setImagen(reader.result as string);\r\n            };\r\n            reader.readAsDataURL(file);\r\n        }\r\n    };\r\n\r\n    // Guardar historia (solo ejemplo, falta mostrar y persistir)\r\n    const handleEnviar = () => {\r\n        // Obtener usuario actual\r\n        let usuario = \"\";\r\n        let userObj = null;\r\n        if (typeof window !== \"undefined\") {\r\n            // Buscar primero en usuarioActual\r\n            const actual = localStorage.getItem(\"usuarioActual\");\r\n            if (actual) {\r\n                try {\r\n                    const obj = JSON.parse(actual);\r\n                    usuario = obj.nick || \"\";\r\n                } catch {\r\n                    usuario = \"\";\r\n                }\r\n            }\r\n            // Si no hay nick, buscar en 'user'\r\n            if (!usuario) {\r\n                const userStr = localStorage.getItem(\"user\");\r\n                if (userStr) {\r\n                    userObj = JSON.parse(userStr);\r\n                    usuario = userObj.nick || \"\";\r\n                }\r\n            }\r\n        }\r\n        if (!anonimo && !usuario) {\r\n            alert(\"No se puede enviar la historia: no se ha detectado usuario. Inicia sesi贸n como docente o alumno.\");\r\n            return;\r\n        }\r\n        // Comprobar palabras prohibidas\r\n        let contieneProhibida = false;\r\n        let palabrasDetectadas: string[] = [];\r\n        if (typeof window !== \"undefined\") {\r\n            const stored = localStorage.getItem(\"prohibitedWords\");\r\n            if (stored) {\r\n                const palabras = JSON.parse(stored);\r\n                const contenidoLower = contenido.toLowerCase();\r\n                palabrasDetectadas = palabras.filter((p: string) =>\r\n                    contenidoLower.includes(p) || contenidoLower.includes(p + \"a\") || contenidoLower.includes(p + \"o\")\r\n                );\r\n                contieneProhibida = palabrasDetectadas.length > 0;\r\n                if (contieneProhibida && usuario) {\r\n                    setShowProhibitedPopup(true);\r\n                    setTimeout(() => setShowProhibitedPopup(false), 30000);\r\n                    // Penalizar solo una vez\r\n                    const usersStr = localStorage.getItem(\"users\");\r\n                    if (usersStr) {\r\n                        let usersArr = JSON.parse(usersStr);\r\n                        usersArr = usersArr.map((u: any) =>\r\n                            u.nick === usuario ? { ...u, likes: (u.likes || 0) - 10 } : u\r\n                        );\r\n                        localStorage.setItem(\"users\", JSON.stringify(usersArr));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        // Crear historia\r\n        const nuevaHistoria = {\r\n            id: Date.now(),\r\n            titulo,\r\n            contenido,\r\n            autor: anonimo ? \"An贸nimo\" : usuario,\r\n            fecha: new Date().toLocaleString(),\r\n            imagen,\r\n            likes: 0,\r\n            comentarios: [],\r\n            concurso: esConcurso ? numConcurso : \"\"\r\n        };\r\n        // Guardar en localStorage\r\n        let historias = [];\r\n        if (typeof window !== \"undefined\") {\r\n            const guardadas = localStorage.getItem(\"historias\");\r\n            historias = guardadas ? JSON.parse(guardadas) : [];\r\n            historias.unshift(nuevaHistoria); // A帽adir al principio\r\n            localStorage.setItem(\"historias\", JSON.stringify(historias));\r\n            // A帽adir la historia al array user.historias y actualizar en localStorage\r\n            if (userObj && usuario) {\r\n                const userHistorias = Array.isArray(userObj.historias) ? userObj.historias : [];\r\n                userObj.historias = [nuevaHistoria.id, ...userHistorias];\r\n                localStorage.setItem(\"user\", JSON.stringify(userObj));\r\n                // Actualizar tambi茅n en el array de usuarios\r\n                const usersStr = localStorage.getItem(\"users\");\r\n                if (usersStr) {\r\n                    let usersArr: any[] = JSON.parse(usersStr);\r\n                    usersArr = usersArr.map((u: any) =>\r\n                        u.nick === usuario ? { ...u, historias: [nuevaHistoria.id, ...(Array.isArray(u.historias) ? u.historias : [])] } : u\r\n                    );\r\n                    localStorage.setItem(\"users\", JSON.stringify(usersArr));\r\n                }\r\n            }\r\n        }\r\n        alert(\"Historia enviada!\");\r\n        setTitulo(\"\");\r\n        setContenido(\"\");\r\n        setImagen(null);\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-green-100 p-8\">\r\n            <h1 className=\"text-2xl font-bold mb-4 text-center\">Crea tu Historia</h1>\r\n            <div className=\"flex w-full justify-center items-start gap-8\">\r\n                {/* Sidebar lateral */}\r\n                <div className=\"bg-white rounded-lg shadow-md p-6 w-64 flex flex-col gap-6\">\r\n                    <div>\r\n                        <label className=\"block font-semibold mb-2\">Modo de historia:</label>\r\n                        <select className=\"w-full border rounded px-2 py-1\">\r\n                            <option>Real</option>\r\n                            <option>Ficticia</option>\r\n                        </select>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block font-semibold mb-2\">Tipo de historia:</label>\r\n                        <select className=\"w-full border rounded px-2 py-1\">\r\n                            <option>Aventura</option>\r\n                            <option>Coraz贸n</option>\r\n                            <option>Terror</option>\r\n                            <option>Ficci贸n</option>\r\n                            <option>Educativa</option>\r\n                            <option>My Live</option>\r\n                            <option>Concurso</option>\r\n                        </select>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"inline-flex items-center\">\r\n                            <input type=\"checkbox\" className=\"form-checkbox mr-2\" checked={anonimo} onChange={e => setAnonimo(e.target.checked)} />\r\n                            Escribir en modo An贸nimo\r\n                        </label>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"inline-flex items-center mt-2\">\r\n                            <input type=\"checkbox\" className=\"form-checkbox mr-2\" checked={esConcurso} onChange={e => setEsConcurso(e.target.checked)} />\r\n                            Escribir en modo Concurso\r\n                        </label>\r\n                        {esConcurso && (\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"N煤mero de concurso\"\r\n                                className=\"w-full border rounded px-2 py-1 mt-2\"\r\n                                value={numConcurso}\r\n                                onChange={e => setNumConcurso(e.target.value.replace(/[^0-9]/g, \"\"))}\r\n                            />\r\n                        )}\r\n                    </div>\r\n                </div>\r\n                {/* Bloque principal de historia */}\r\n                <div className=\"bg-white rounded-lg shadow-md p-6 flex-1 flex flex-col gap-6\">\r\n                    {/* Espacio para el t铆tulo de la historia con campo de concurso a la derecha */}\r\n                    <div className=\"flex gap-2 items-center\">\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"T铆tulo de la historia\"\r\n                            className=\"w-full border rounded px-3 py-2 font-semibold text-lg mb-2\"\r\n                            value={titulo}\r\n                            onChange={e => setTitulo(e.target.value)}\r\n                        />\r\n                        {esConcurso && (\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"N潞 concurso\"\r\n                                className=\"border rounded px-2 py-1 w-24 text-center\"\r\n                                value={numConcurso}\r\n                                onChange={e => setNumConcurso(e.target.value.replace(/[^0-9]/g, \"\"))}\r\n                            />\r\n                        )}\r\n                    </div>\r\n                    {/* Botones de formato */}\r\n                    <div className=\"flex gap-2 mb-2\">\r\n                        <button type=\"button\" className=\"bg-gray-200 px-2 py-1 rounded font-bold\" title=\"Negrita\" onClick={() => aplicarFormato(\"bold\")}>B</button>\r\n                        <button type=\"button\" className=\"bg-gray-200 px-2 py-1 rounded font-bold\" title=\"Subrayado\" onClick={() => aplicarFormato(\"underline\")}>S</button>\r\n                        <label className=\"bg-gray-200 px-2 py-1 rounded cursor-pointer font-bold\" title=\"Subir imagen\">\r\n                            \r\n                            <input type=\"file\" accept=\"image/*\" className=\"hidden\" onChange={handleImagen} />\r\n                        </label>\r\n                    </div>\r\n                    {/* Bloque de escritura y previsualizaci贸n */}\r\n                    <div className=\"flex flex-col gap-2\">\r\n                        <div className=\"w-full mb-2\">\r\n                            <textarea\r\n                                ref={textareaRef}\r\n                                placeholder=\"Escribe tu historia aqu铆...\"\r\n                                className=\"w-full border rounded px-3 py-2 min-h-[120px] mb-2\"\r\n                                value={contenido}\r\n                                onChange={e => setContenido(e.target.value)}\r\n                                style={imagen ? {\r\n                                    resize: 'vertical',\r\n                                    backgroundImage: `url(${imagen})`,\r\n                                    backgroundRepeat: 'no-repeat',\r\n                                    backgroundPosition: 'center',\r\n                                    backgroundSize: 'contain',\r\n                                    opacity: 0.95\r\n                                } : { resize: 'vertical' }}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    {/* Eliminado: previsualizaci贸n duplicada y textarea extra */}\r\n                    {/* Bot贸n de enviar */}\r\n                    <button className=\"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded self-end\" onClick={handleEnviar}>Enviar</button>\r\n                </div>\r\n            </div>\r\n            {showProhibitedPopup && palabrasDetectadas.length > 0 && (\r\n                <div className=\"fixed top-8 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-6 py-4 rounded shadow-lg z-50 text-lg font-bold\">\r\n                    Palabra prohibida -10 likes de penalizaci贸n<br />\r\n                    Detectadas: {palabrasDetectadas.join(\", \")}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"wDACA,EAAA,EAAA,CAAA,CAAA,OACe,SAAS,IACpB,GAAM,CAAC,EAAQ,EAAU,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAC/B,CAAC,EAAW,EAAa,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAS,IACrC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAC7B,CAAC,EAAQ,EAAU,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MAC9C,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjC,CAAC,EAAY,EAAc,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACvC,CAAC,EAAa,EAAe,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACzC,CAAC,EAAqB,EAAuB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACzD,CAAC,EAAoB,EAAsB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAW,EAAE,EACnE,EAAc,CAAA,EAAA,EAAA,MAAA,AAAM,EAAsB,MAG1C,EAAiB,AAAC,IACpB,IAAM,EAAW,EAAY,OAAO,CACpC,GAAI,CAAC,EAAU,OACf,IAAM,EAAQ,EAAS,cAAc,CAC/B,EAAM,EAAS,YAAY,CAE7B,GACA,CAAY,QAAQ,CADP,EAEb,EAAa,EAAM,KAAK,CAAC,EAAG,GAAS,MAAQ,EAAM,KAAK,CAAC,EAAO,GAAO,OAAS,EAAM,KAAK,CAAC,GACzE,aAAa,CAAzB,IACP,EAAa,EAAM,KAAK,CAAC,EAAG,GAAS,MAAQ,EAAM,KAAK,CAAC,EAAO,GAAO,OAAS,AALtE,EAK4E,KAAK,CAAC,EAAA,EAEhG,EAAa,EACjB,EA+GA,MACI,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,0CACX,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,+CAAsC,qBACpD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,yDAEX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uEACX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACG,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,oCAA2B,sBAC5C,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CAAO,UAAU,4CACd,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,SACR,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,mBAGhB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACG,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,oCAA2B,sBAC5C,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CAAO,UAAU,4CACd,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,aACR,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,YACR,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,WACR,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,YACR,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,cACR,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,YACR,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,mBAGhB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,UACG,CAAA,EAAA,EAAA,IAAA,EAAC,QAAA,CAAM,UAAU,qCACb,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,KAAK,WAAW,UAAU,qBAAqB,QAAS,EAAS,SAAU,GAAK,EAAW,EAAE,MAAM,CAAC,OAAO,IAAK,gCAI/H,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACG,CAAA,EAAA,EAAA,IAAA,EAAC,QAAA,CAAM,UAAU,0CACb,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,KAAK,WAAW,UAAU,qBAAqB,QAAS,EAAY,SAAU,GAAK,EAAc,EAAE,MAAM,CAAC,OAAO,IAAK,+BAGhI,GACG,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACG,KAAK,OACL,YAAY,qBACZ,UAAU,uCACV,MAAO,EACP,SAAU,GAAK,EAAe,EAAE,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,UAAW,aAMhF,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,yEAEX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oCACX,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACG,KAAK,OACL,YAAY,wBACZ,UAAU,6DACV,MAAO,EACP,SAAU,GAAK,EAAU,EAAE,MAAM,CAAC,KAAK,IAE1C,GACG,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACG,KAAK,OACL,YAAY,cACZ,UAAU,4CACV,MAAO,EACP,SAAU,GAAK,EAAe,EAAE,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,UAAW,UAK5E,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,4BACX,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,KAAK,SAAS,UAAU,0CAA0C,MAAM,UAAU,QAAS,IAAM,EAAe,iBAAS,MACjI,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,KAAK,SAAS,UAAU,0CAA0C,MAAM,YAAY,QAAS,IAAM,EAAe,sBAAc,MACxI,CAAA,EAAA,EAAA,IAAA,EAAC,QAAA,CAAM,UAAU,yDAAyD,MAAM,yBAAe,KAE3F,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,KAAK,OAAO,OAAO,UAAU,UAAU,SAAS,SAtL1D,AAAC,CAsLmE,GArLrF,IAAM,EAAO,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,CAChC,GAAI,EAAM,CACN,IAAM,EAAS,IAAI,UACnB,GAAO,MAAM,CAAG,KACZ,EAAU,EAAO,MAAM,CAC3B,EACA,EAAO,aAAa,CAAC,EACzB,CACJ,UAiLgB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,+BACX,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,uBACX,CAAA,EAAA,EAAA,GAAA,EAAC,WAAA,CACG,IAAK,EACL,YAAY,8BACZ,UAAU,qDACV,MAAO,EACP,SAAU,GAAK,EAAa,EAAE,MAAM,CAAC,KAAK,EAC1C,MAAO,EAAS,CACZ,OAAQ,WACR,gBAAiB,CAAC,IAAI,EAAE,EAAO,CAAC,CAAC,CACjC,iBAAkB,YAClB,mBAAoB,SACpB,eAAgB,UAChB,QAAS,GACb,EAAI,CAAE,OAAQ,UAAW,QAMrC,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,UAAU,kFAAkF,QAnM/F,CAmMwG,IA3KpH,AAAL,GAiCQ,CAjCJ,IAiCS,GAjCG,AAiCA,CAjCC,EAqCN,IAAI,GArCW,IAqCJ,cAAc,GA6BpC,MAAM,qBACN,EAAU,IACV,EAAa,IACb,EAAU,OApEN,MAAM,mGAqEd,WAqG2I,iBAGlI,GAAuB,EAAmB,MAAM,CAAG,GAChD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,qIAA2H,8CAC3F,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAA,GAAK,eACpC,EAAmB,IAAI,CAAC,WAKzD"}