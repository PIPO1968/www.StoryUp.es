{"version":3,"sources":["turbopack:///[project]/src/app/estadisticas/page.tsx"],"sourcesContent":["\"use client\";\r\nimport React from \"react\";\r\nimport { renderNick } from \"@/utils/renderNick\";\r\nimport { useTranslation } from '@/utils/i18n';\r\n\r\nexport default function Estadisticas() {\r\n    const { t } = useTranslation();\r\n    // Estado para detectar si el usuario es Premium\r\n    const [isPremium, setIsPremium] = React.useState(false);\r\n    const [currentUser, setCurrentUser] = React.useState<any>(null);\r\n\r\n    // Funci√≥n para calcular puntos totales de un usuario\r\n    function calcularPuntosTotales(user: any): number {\r\n        if (!user || !user.nick) return 0;\r\n\r\n        let puntosTotales = 0;\r\n\r\n        // Puntos por asignaturas\r\n        const asignaturas = ['matematicas', 'lenguaje', 'geografia', 'historia', 'literatura', 'ingles', 'naturaleza'];\r\n        asignaturas.forEach(asignatura => {\r\n            const puntosAsignatura = parseInt(localStorage.getItem(`${asignatura}_${user.nick}`) || '0', 10);\r\n            puntosTotales += puntosAsignatura;\r\n        });\r\n\r\n        // Puntos por likes (cada like cuenta como punto)\r\n        puntosTotales += user.likes || 0;\r\n\r\n        // Puntos por competiciones superadas (cada competici√≥n superada vale 10 puntos)\r\n        puntosTotales += (user.competicionesSuperadas || 0) * 10;\r\n\r\n        // Puntos por preguntas acertadas (cada pregunta acertada vale 2 puntos)\r\n        puntosTotales += (user.preguntasAcertadas || 0) * 2;\r\n\r\n        return puntosTotales;\r\n    }\r\n\r\n    // Temporadas disponibles\r\n    function getCurrentSeason() {\r\n        const now = new Date();\r\n        const year = now.getFullYear();\r\n        if (now.getMonth() + 1 < 10) {\r\n            return year - 1;\r\n        }\r\n        return year;\r\n    }\r\n    const [temporadaSeleccionada, setTemporadaSeleccionada] = React.useState<number>(getCurrentSeason());\r\n    const [temporadasDisponibles, setTemporadasDisponibles] = React.useState<number[]>([]);\r\n    const [tablaIndividual, setTablaIndividual] = React.useState<Record<string, any>>({});\r\n    const [tablaCentro, setTablaCentro] = React.useState<Record<string, any>>({});\r\n    const [tablaDocentes, setTablaDocentes] = React.useState<Record<string, any>>({});\r\n    const [isClient, setIsClient] = React.useState(false);\r\n    const [rankingCentros, setRankingCentros] = React.useState<Array<{ centro: string; likes: number }>>([]);\r\n    const [centrosReady, setCentrosReady] = React.useState(false);\r\n    React.useEffect(() => {\r\n        setIsClient(true);\r\n\r\n        // Detectar si el usuario actual es Premium\r\n        if (typeof window !== \"undefined\") {\r\n            const userData = localStorage.getItem('currentUser') || localStorage.getItem('user');\r\n            if (userData) {\r\n                const user = JSON.parse(userData);\r\n                setCurrentUser(user);\r\n\r\n                // Verificar si tiene Premium activo\r\n                const premiumInfo = localStorage.getItem(`premium_${user.nick}`);\r\n                if (premiumInfo) {\r\n                    const premium = JSON.parse(premiumInfo);\r\n                    if (new Date(premium.expiracion) > new Date()) {\r\n                        setIsPremium(true);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        function cargarDatos() {\r\n            // Forzar actualizaci√≥n de estado si es necesario\r\n            setTemporadasDisponibles((prev) => [...prev]);\r\n            setTablaIndividual((prev) => ({ ...prev }));\r\n            setTablaCentro((prev) => ({ ...prev }));\r\n            setTablaDocentes((prev) => ({ ...prev }));\r\n            setRankingCentros((prev) => [...prev]);\r\n            setCentrosReady((prev) => prev);\r\n        }\r\n        function handleStorage() {\r\n            cargarDatos();\r\n        }\r\n        window.addEventListener('storage', handleStorage);\r\n        return () => {\r\n            window.removeEventListener('storage', handleStorage);\r\n        };\r\n    }, []);\r\n    React.useEffect(() => {\r\n        function getTemporadasDisponibles() {\r\n            const temporadas: number[] = [];\r\n            if (typeof window !== \"undefined\") {\r\n                for (let i = 2023; i <= getCurrentSeason(); i++) {\r\n                    if (localStorage.getItem(`campeonato_individual_t${i}`) || localStorage.getItem(`campeonato_centro_t${i}`)) {\r\n                        temporadas.push(i);\r\n                    }\r\n                }\r\n                if (!temporadas.includes(getCurrentSeason())) {\r\n                    temporadas.push(getCurrentSeason());\r\n                }\r\n            }\r\n            return temporadas.sort((a, b) => b - a);\r\n        }\r\n        setTemporadasDisponibles(getTemporadasDisponibles());\r\n    }, []);\r\n    React.useEffect(() => {\r\n        if (typeof window !== \"undefined\") {\r\n            const keyInd = `campeonato_individual_t${temporadaSeleccionada}`;\r\n            const keyCentro = `campeonato_centro_t${temporadaSeleccionada}`;\r\n            let tablaInd = {};\r\n            let tablaCent = {};\r\n            try {\r\n                tablaInd = JSON.parse(localStorage.getItem(keyInd) || '{}');\r\n            } catch { tablaInd = {}; }\r\n            try {\r\n                tablaCent = JSON.parse(localStorage.getItem(keyCentro) || '{}');\r\n            } catch { tablaCent = {}; }\r\n            setTablaIndividual(tablaInd);\r\n            setTablaCentro(tablaCent);\r\n        }\r\n    }, [temporadaSeleccionada]);\r\n    React.useEffect(() => {\r\n        if (typeof window !== \"undefined\") {\r\n            const docentesStr = localStorage.getItem(`campeonato_docentes_t${temporadaSeleccionada}`);\r\n            let tablaDoc = {};\r\n            try {\r\n                tablaDoc = docentesStr ? JSON.parse(docentesStr) : {};\r\n            } catch { tablaDoc = {}; }\r\n            setTablaDocentes(tablaDoc);\r\n        }\r\n    }, [temporadaSeleccionada]);\r\n    React.useEffect(() => {\r\n        if (typeof window !== \"undefined\") {\r\n            const usersStr = localStorage.getItem(\"users\");\r\n            if (usersStr) {\r\n                try {\r\n                    const usersArr = JSON.parse(usersStr);\r\n                    const likesPorCentro: Record<string, number> = {};\r\n                    usersArr.forEach((u: any) => {\r\n                        if (u.centro) {\r\n                            if (!(u.centro in likesPorCentro)) likesPorCentro[u.centro] = 0;\r\n                            likesPorCentro[u.centro] += Number(u.likes) || 0;\r\n                        }\r\n                    });\r\n                    const ranking = Object.entries(likesPorCentro)\r\n                        .map(([centro, likes]) => ({ centro, likes }))\r\n                        .sort((a, b) => b.likes - a.likes);\r\n                    setRankingCentros(ranking);\r\n                } catch {\r\n                    setRankingCentros([]);\r\n                }\r\n            } else {\r\n                setRankingCentros([]);\r\n            }\r\n            setCentrosReady(true);\r\n        }\r\n    }, []);\r\n    function handleTemporadaChange(e: React.ChangeEvent<HTMLSelectElement>) {\r\n        setTemporadaSeleccionada(Number(e.target.value));\r\n    }\r\n    function getTablaIndividual(temporada: number) {\r\n        const key = `campeonato_individual_t${temporada}`;\r\n        return JSON.parse(localStorage.getItem(key) || '{}');\r\n    }\r\n    function getTablaCentro(temporada: number) {\r\n        const key = `campeonato_centro_t${temporada}`;\r\n        return JSON.parse(localStorage.getItem(key) || '{}');\r\n    }\r\n\r\n    // Utilidad para mostrar nick como link si es v√°lido\r\n    function NickLink({ nick }: { nick: string }) {\r\n        return renderNick(nick);\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-green-100 p-8\">\r\n            <div className=\"text-center mb-4\">\r\n                <h1 className=\"text-2xl font-bold\">\r\n                    {isPremium ? (\r\n                        <>\r\n                            <span className=\"text-yellow-600\">{t('estadisticasPremium')}</span>\r\n                            <div className=\"text-sm text-gray-600 mt-1\">\r\n                                ¬°Hola {currentUser?.nick}! Disfrutas de estad√≠sticas avanzadas\r\n                            </div>\r\n                        </>\r\n                    ) : (\r\n                        <>\r\n                            Estad√≠sticas\r\n                            <div className=\"text-sm text-blue-600 mt-1\">\r\n                                <button\r\n                                    onClick={() => window.location.href = '/premium-nuevo'}\r\n                                    className=\"bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-3 py-1 rounded-full text-xs hover:shadow-lg transform hover:scale-105 transition-all\"\r\n                                >\r\n                                    ‚ú® {t('haztePremiumParaVer')} ‚ú®\r\n                                </button>\r\n                            </div>\r\n                        </>\r\n                    )}\r\n                </h1>\r\n            </div>\r\n            {isClient && (\r\n                <>\r\n                    {/* Bloque 1: Estad√≠sticas Globales */}\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 max-w-5xl mx-auto\">\r\n                        <div className=\"bg-white rounded-lg shadow-md p-6\">\r\n                            <h2 className=\"text-lg font-bold mb-4 text-center\">{t('estadisticasGlobales')}</h2>\r\n                            <ul className=\"space-y-2\">\r\n                                <li><span className=\"mr-2 text-xl\">üèÜ</span><b>{t('totalCompeticionesSuperadas')}:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const usersStr = localStorage.getItem(\"users\");\r\n                                        if (usersStr) {\r\n                                            try {\r\n                                                const usersArr = JSON.parse(usersStr);\r\n                                                let total = 0;\r\n                                                usersArr.forEach((u: any) => {\r\n                                                    total += u.competicionesSuperadas || 0;\r\n                                                });\r\n                                                return total;\r\n                                            } catch { return 0; }\r\n                                        }\r\n                                    }\r\n                                    return 0;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">üë•</span><b>{t('totalUsuarios')}:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const usersStr = localStorage.getItem(\"users\");\r\n                                        if (usersStr) {\r\n                                            try {\r\n                                                const usersArr = JSON.parse(usersStr);\r\n                                                return usersArr.length;\r\n                                            } catch { return 0; }\r\n                                        }\r\n                                    }\r\n                                    return 0;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">üìñ</span><b>{t('totalHistoriasCreadas')}:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const historiasStr = localStorage.getItem(\"historias\");\r\n                                        if (historiasStr) {\r\n                                            try {\r\n                                                const historiasArr = JSON.parse(historiasStr);\r\n                                                return historiasArr.length;\r\n                                            } catch { return 0; }\r\n                                        }\r\n                                    }\r\n                                    return 0;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">üèÜ</span><b>{t('totalConcursosCreados')}:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const concursosStr = localStorage.getItem(\"concursos\");\r\n                                        if (concursosStr) {\r\n                                            try {\r\n                                                const concursosArr = JSON.parse(concursosStr);\r\n                                                return concursosArr.length;\r\n                                            } catch { return 0; }\r\n                                        }\r\n                                    }\r\n                                    return 0;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">üí¨</span><b>Total de comentarios realizados:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const historiasStr = localStorage.getItem(\"historias\");\r\n                                        if (historiasStr) {\r\n                                            try {\r\n                                                const historiasArr = JSON.parse(historiasStr);\r\n                                                let total = 0;\r\n                                                historiasArr.forEach((h: any) => {\r\n                                                    total += h.comentarios ? h.comentarios.length : 0;\r\n                                                });\r\n                                                return total;\r\n                                            } catch { return 0; }\r\n                                        }\r\n                                    }\r\n                                    return 0;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">üè´</span><b>Total de centros escolares registrados:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const usersStr = localStorage.getItem(\"users\");\r\n                                        if (usersStr) {\r\n                                            try {\r\n                                                const usersArr = JSON.parse(usersStr);\r\n                                                const centros = new Set(usersArr.map((u: any) => u.centro).filter(Boolean));\r\n                                                return centros.size;\r\n                                            } catch { return 0; }\r\n                                        }\r\n                                    }\r\n                                    return 0;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">üë®‚Äçüè´</span><b>Total de docentes registrados:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const usersStr = localStorage.getItem(\"users\");\r\n                                        if (usersStr) {\r\n                                            try {\r\n                                                const usersArr = JSON.parse(usersStr);\r\n                                                const docentesArr = usersArr.filter((u: any) => (u.tipo || \"\").toLowerCase() === \"docente\");\r\n                                                return docentesArr.length || 0;\r\n                                            } catch { return 0; }\r\n                                        }\r\n                                        return 0;\r\n                                    }\r\n                                    return 0;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">ü§ù</span><b>Total de amigos creados:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const usersStr = localStorage.getItem(\"users\");\r\n                                        if (usersStr) {\r\n                                            try {\r\n                                                const usersArr = JSON.parse(usersStr);\r\n                                                let total = 0;\r\n                                                usersArr.forEach((u: any) => {\r\n                                                    const amigosStr = localStorage.getItem(`amigos_${u.nick}`);\r\n                                                    if (amigosStr) {\r\n                                                        try {\r\n                                                            const amigosArr = JSON.parse(amigosStr);\r\n                                                            total += amigosArr.length;\r\n                                                        } catch { }\r\n                                                    }\r\n                                                });\r\n                                                return total > 0 ? total : 0;\r\n                                            } catch { return 0; }\r\n                                        }\r\n                                        return 0;\r\n                                    }\r\n                                    return 0;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">üèÖ</span><b>Total de historias ganadoras:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const concursosStr = localStorage.getItem(\"concursos\");\r\n                                        if (concursosStr) {\r\n                                            try {\r\n                                                const concursosArr = JSON.parse(concursosStr);\r\n                                                return concursosArr.filter((c: any) => c.historiaGanadora).length || 0;\r\n                                            } catch { return 0; }\r\n                                        }\r\n                                        return 0;\r\n                                    }\r\n                                    return 0;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span><b>Total de participantes en concursos:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const usersStr = localStorage.getItem(\"users\");\r\n                                        if (usersStr) {\r\n                                            try {\r\n                                                const usersArr = JSON.parse(usersStr);\r\n                                                let count = 0;\r\n                                                usersArr.forEach((u: any) => {\r\n                                                    if (u.historias && Array.isArray(u.historias) && u.historias.length > 0) {\r\n                                                        count++;\r\n                                                    }\r\n                                                });\r\n                                                return count;\r\n                                            } catch { return 0; }\r\n                                        }\r\n                                        return 0;\r\n                                    }\r\n                                    return 0;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">‚ù§Ô∏è</span><b>Total de likes:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const usersStr = localStorage.getItem(\"users\");\r\n                                        if (usersStr) {\r\n                                            try {\r\n                                                const usersArr = JSON.parse(usersStr);\r\n                                                let total = 0;\r\n                                                usersArr.forEach((u: any) => {\r\n                                                    total += (u.likes || 0);\r\n                                                });\r\n                                                return total;\r\n                                            } catch { return 0; }\r\n                                        }\r\n                                    }\r\n                                    return 0;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">‚ùì</span><b>Total de preguntas respondidas:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const usersStr = localStorage.getItem(\"users\");\r\n                                        if (usersStr) {\r\n                                            try {\r\n                                                const usersArr = JSON.parse(usersStr);\r\n                                                let totalAcertadas = 0;\r\n                                                let totalFalladas = 0;\r\n                                                usersArr.forEach((u: any) => {\r\n                                                    totalAcertadas += u.preguntasAcertadas || 0;\r\n                                                    totalFalladas += u.preguntasFalladas || 0;\r\n                                                    totalFalladas += parseInt(localStorage.getItem('falladas_' + u.nick) || '0', 10);\r\n                                                });\r\n                                                return totalAcertadas + totalFalladas;\r\n                                            } catch { return 0; }\r\n                                        }\r\n                                    }\r\n                                    return 0;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">‚ùì</span><b>{t('totalPreguntasAcertadas')}:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const usersStr = localStorage.getItem(\"users\");\r\n                                        if (usersStr) {\r\n                                            try {\r\n                                                const usersArr = JSON.parse(usersStr);\r\n                                                let total = 0;\r\n                                                usersArr.forEach((u: any) => {\r\n                                                    total += u.preguntasAcertadas || 0;\r\n                                                });\r\n                                                return total;\r\n                                            } catch { return 0; }\r\n                                        }\r\n                                    }\r\n                                    return 0;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">‚ùì</span><b>Total de preguntas falladas:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const usersStr = localStorage.getItem(\"users\");\r\n                                        if (usersStr) {\r\n                                            try {\r\n                                                const usersArr = JSON.parse(usersStr);\r\n                                                let total = 0;\r\n                                                usersArr.forEach((u: any) => {\r\n                                                    total += u.preguntasFalladas || 0;\r\n                                                    total += parseInt(localStorage.getItem('falladas_' + u.nick) || '0', 10);\r\n                                                });\r\n                                                return total;\r\n                                            } catch { return 0; }\r\n                                        }\r\n                                    }\r\n                                    return 0;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">üèÜ</span><b>Total de concursos ganados:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const usersStr = localStorage.getItem(\"users\");\r\n                                        if (usersStr) {\r\n                                            try {\r\n                                                const usersArr = JSON.parse(usersStr);\r\n                                                let total = 0;\r\n                                                usersArr.forEach((u: any) => {\r\n                                                    total += u.concursosGanados || 0;\r\n                                                });\r\n                                                return total;\r\n                                            } catch { return 0; }\r\n                                        }\r\n                                    }\r\n                                    return 0;\r\n                                })()}</li>\r\n                            </ul>\r\n                        </div>\r\n                        {/* Bloque 2: Rankings */}\r\n                        <div className=\"bg-white rounded-lg shadow-md p-6\">\r\n                            <h2 className=\"text-lg font-bold mb-4 text-center\">Rankings</h2>\r\n                            <ul className=\"space-y-2\">\r\n                                <li><span className=\"mr-2 text-xl\">‚ù§Ô∏è</span><b>{t('usuariosMasLikes')}:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const usersStr = localStorage.getItem(\"users\");\r\n                                        if (usersStr) {\r\n                                            try {\r\n                                                const usersArr = JSON.parse(usersStr);\r\n                                                const ranking = usersArr.map((u: any) => {\r\n                                                    return {\r\n                                                        nick: u.nick,\r\n                                                        nombre: u.nombre,\r\n                                                        totalLikes: (u.likes || 0)\r\n                                                    };\r\n                                                })\r\n                                                    .filter((u: { nick: string; nombre: string; totalLikes: number }) => u.nick && u.totalLikes > 0) // Solo usuarios con al menos 1 like\r\n                                                    .sort((a: { totalLikes: number }, b: { totalLikes: number }) => b.totalLikes - a.totalLikes)\r\n                                                    .slice(0, 5);\r\n                                                if (ranking.length === 0) return <span className=\"block\">No hay usuarios con likes.</span>;\r\n                                                return ranking.map((u: { nick: string; totalLikes: number }, i: number) => (\r\n                                                    <span key={u.nick} className=\"block\">{i + 1}. <b><NickLink nick={u.nick} /></b> ({u.totalLikes} likes)</span>\r\n                                                ));\r\n                                            } catch { return <span className=\"block\">No hay usuarios con likes.</span>; }\r\n                                        }\r\n                                    }\r\n                                    return <span className=\"block\">No hay usuarios con likes.</span>;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">üí¨</span><b>{t('usuariosMasComentarios')}:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const historiasStr = localStorage.getItem(\"historias\");\r\n                                        if (historiasStr) {\r\n                                            try {\r\n                                                const historiasArr = JSON.parse(historiasStr);\r\n                                                const comentariosPorAutor: Record<string, number> = {};\r\n                                                historiasArr.forEach((h: any) => {\r\n                                                    if (h.autor) {\r\n                                                        comentariosPorAutor[h.autor] = (comentariosPorAutor[h.autor] || 0) + (h.comentarios ? h.comentarios.length : 0);\r\n                                                    }\r\n                                                });\r\n                                                const ranking = Object.entries(comentariosPorAutor)\r\n                                                    .map(([nick, totalComentarios]: [string, number]) => ({ nick, totalComentarios }))\r\n                                                    .filter((u: { nick: string; totalComentarios: number }) => u.nick && u.totalComentarios > 0)\r\n                                                    .sort((a: { totalComentarios: number }, b: { totalComentarios: number }) => b.totalComentarios - a.totalComentarios)\r\n                                                    .slice(0, 5);\r\n                                                if (ranking.length === 0) return <span className=\"block\">No hay usuarios con comentarios a√∫n.</span>;\r\n                                                return ranking.map((u: { nick: string; totalComentarios: number }, i: number) => (\r\n                                                    <span key={u.nick} className=\"block\">{i + 1}. <b><NickLink nick={u.nick} /></b> ({u.totalComentarios} comentarios)</span>\r\n                                                ));\r\n                                            } catch { return <span className=\"block\">No hay usuarios con comentarios a√∫n.</span>; }\r\n                                        }\r\n                                    }\r\n                                    return <span className=\"block\">No hay usuarios con comentarios a√∫n.</span>;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">ü§ù</span><b>Usuarios con m√°s amigos:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const usersStr = localStorage.getItem(\"users\");\r\n                                        if (usersStr) {\r\n                                            try {\r\n                                                const usersArr = JSON.parse(usersStr);\r\n                                                const ranking = usersArr\r\n                                                    .map((u: any) => {\r\n                                                        const amigosStr = localStorage.getItem(`amigos_${u.nick}`);\r\n                                                        let numAmigos = 0;\r\n                                                        if (amigosStr) {\r\n                                                            try {\r\n                                                                const amigosArr = JSON.parse(amigosStr);\r\n                                                                numAmigos = Array.isArray(amigosArr) ? amigosArr.length : 0;\r\n                                                            } catch { numAmigos = 0; }\r\n                                                        }\r\n                                                        return {\r\n                                                            nick: u.nick,\r\n                                                            numAmigos\r\n                                                        };\r\n                                                    })\r\n                                                    .filter((u: { nick: string; numAmigos: number }) => u.nick && u.numAmigos > 0)\r\n                                                    .sort((a: { numAmigos: number }, b: { numAmigos: number }) => b.numAmigos - a.numAmigos)\r\n                                                    .slice(0, 5);\r\n                                                if (ranking.length === 0) return <span className=\"block\">No hay usuarios con amigos a√∫n.</span>;\r\n                                                return ranking.map((u: { nick: string; numAmigos: number }, i: number) => (\r\n                                                    <span key={u.nick} className=\"block\">{i + 1}. <b><NickLink nick={u.nick} /></b> ({u.numAmigos} amigos)</span>\r\n                                                ));\r\n                                            } catch { return <span className=\"block\">No hay usuarios con amigos a√∫n.</span>; }\r\n                                        }\r\n                                    }\r\n                                    return <span className=\"block\">No hay usuarios con amigos a√∫n.</span>;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">üìñ</span><b>Usuarios con m√°s historias:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const historiasStr = localStorage.getItem(\"historias\");\r\n                                        if (historiasStr) {\r\n                                            try {\r\n                                                const historiasArr = JSON.parse(historiasStr);\r\n                                                const historiasPorAutor: Record<string, number> = {};\r\n                                                historiasArr.forEach((h: any) => {\r\n                                                    if (h.autor) {\r\n                                                        historiasPorAutor[h.autor] = (historiasPorAutor[h.autor] || 0) + 1;\r\n                                                    }\r\n                                                });\r\n                                                const ranking = Object.entries(historiasPorAutor)\r\n                                                    .map(([nick, totalHistorias]: [string, number]) => ({ nick, totalHistorias }))\r\n                                                    .filter((u: { nick: string; totalHistorias: number }) => u.nick && u.totalHistorias > 0)\r\n                                                    .sort((a: { totalHistorias: number }, b: { totalHistorias: number }) => b.totalHistorias - a.totalHistorias)\r\n                                                    .slice(0, 5);\r\n                                                if (ranking.length === 0) return <span className=\"block\">No hay usuarios con historias a√∫n.</span>;\r\n                                                return ranking.map((u: { nick: string; totalHistorias: number }, i: number) => (\r\n                                                    <span key={u.nick} className=\"block\">{i + 1}. <b><NickLink nick={u.nick} /></b> ({u.totalHistorias} historias)</span>\r\n                                                ));\r\n                                            } catch { return <span className=\"block\">No hay usuarios con historias a√∫n.</span>; }\r\n                                        }\r\n                                    }\r\n                                    return <span className=\"block\">No hay usuarios con historias a√∫n.</span>;\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">üèÜ</span><b>Usuarios con m√°s concursos ganados:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const usersStr = localStorage.getItem(\"users\");\r\n                                        if (usersStr) {\r\n                                            try {\r\n                                                const usersArr = JSON.parse(usersStr);\r\n                                                const ranking = usersArr.map((u: any) => ({\r\n                                                    nick: u.nick,\r\n                                                    nombre: u.nombre,\r\n                                                    totalConcursos: u.concursosGanados || 0\r\n                                                }))\r\n                                                    .filter((u: { nick: string; nombre: string; totalConcursos: number }) => u.totalConcursos > 0)\r\n                                                    .sort((a: { totalConcursos: number }, b: { totalConcursos: number }) => b.totalConcursos - a.totalConcursos)\r\n                                                    .slice(0, 5);\r\n                                                if (ranking.length === 0) return <span className=\"block\">No hay usuarios con concursos ganados a√∫n.</span>;\r\n                                                return ranking.map((u: { nick: string; totalConcursos: number }, i: number) => (\r\n                                                    <span key={u.nick} className=\"block\">{i + 1}. <b><NickLink nick={u.nick} /></b> ({u.totalConcursos} concursos)</span>\r\n                                                ));\r\n                                            } catch { return \"-\"; }\r\n                                        }\r\n                                    }\r\n                                    return \"-\";\r\n                                })()}</li>\r\n                                <li><span className=\"mr-2 text-xl\">üèÜ</span><b>Usuarios con m√°s competiciones superadas:</b> {(() => {\r\n                                    if (typeof window !== \"undefined\") {\r\n                                        const usersStr = localStorage.getItem(\"users\");\r\n                                        if (usersStr) {\r\n                                            try {\r\n                                                const usersArr = JSON.parse(usersStr);\r\n                                                const ranking = usersArr\r\n                                                    .map((u: any) => ({\r\n                                                        nick: u.nick,\r\n                                                        nombre: u.nombre,\r\n                                                        totalCompeticiones: u.competicionesSuperadas || 0\r\n                                                    }))\r\n                                                    .filter((u: { totalCompeticiones: number }) => u.totalCompeticiones > 0)\r\n                                                    .sort((a: { totalCompeticiones: number }, b: { totalCompeticiones: number }) => b.totalCompeticiones - a.totalCompeticiones)\r\n                                                    .slice(0, 5);\r\n                                                if (ranking.length === 0) return <span className=\"block\">No hay usuarios con competiciones superadas a√∫n.</span>;\r\n                                                return ranking.map((u: { nick: string; totalCompeticiones: number }, i: number) => (\r\n                                                    <span key={u.nick} className=\"block\">{i + 1}. <b><NickLink nick={u.nick} /></b> ({u.totalCompeticiones} competiciones)</span>\r\n                                                ));\r\n                                            } catch { return \"-\"; }\r\n                                        }\r\n                                    }\r\n                                    return \"-\";\r\n                                })()}</li>\r\n\r\n                            </ul>\r\n                        </div>\r\n                    </div >\r\n\r\n                    {/* Bloque Premium: Estad√≠sticas Avanzadas Solo para Premium */}\r\n                    {isPremium && (\r\n                        <div className=\"max-w-5xl mx-auto mt-8\">\r\n                            <div className=\"bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 rounded-2xl p-1 shadow-2xl\">\r\n                                <div className=\"bg-white rounded-2xl p-6\">\r\n                                    <h2 className=\"text-xl font-bold text-center mb-6 text-transparent bg-clip-text bg-gradient-to-r from-yellow-500 to-orange-600\">\r\n                                        üëë Estad√≠sticas Premium Avanzadas üëë\r\n                                    </h2>\r\n\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                                        {/* An√°lisis Personal Premium */}\r\n                                        <div className=\"bg-gradient-to-br from-blue-50 to-indigo-100 rounded-xl p-4\">\r\n                                            <h3 className=\"font-bold text-blue-800 mb-3 text-center\">üìà Tu An√°lisis Personal</h3>\r\n                                            <ul className=\"space-y-2 text-sm\">\r\n                                                <li className=\"flex justify-between\">\r\n                                                    <span>üéØ Precisi√≥n promedio:</span>\r\n                                                    <span className=\"font-bold text-blue-600\">{(() => {\r\n                                                        if (currentUser) {\r\n                                                            const acertadas = (currentUser.preguntasAcertadas || 0) + parseInt(localStorage.getItem('acertadas_' + currentUser.nick) || '0', 10);\r\n                                                            const falladas = (currentUser.preguntasFalladas || 0) + parseInt(localStorage.getItem('falladas_' + currentUser.nick) || '0', 10);\r\n                                                            const total = acertadas + falladas;\r\n                                                            return total > 0 ? ((acertadas / total) * 100).toFixed(1) + '%' : '0%';\r\n                                                        }\r\n                                                        return '0%';\r\n                                                    })()}</span>\r\n                                                </li>\r\n                                                <li className=\"flex justify-between\">\r\n                                                    <span>‚ö° Racha actual:</span>\r\n                                                    <span className=\"font-bold text-blue-600\">{currentUser?.racha || 0} d√≠as</span>\r\n                                                </li>\r\n                                                <li className=\"flex justify-between\">\r\n                                                    <span>üìÖ D√≠as activo:</span>\r\n                                                    <span className=\"font-bold text-blue-600\">{(() => {\r\n                                                        if (currentUser?.fechaRegistro) {\r\n                                                            const fechaReg = new Date(currentUser.fechaRegistro);\r\n                                                            const ahora = new Date();\r\n                                                            const diffTime = Math.abs(ahora.getTime() - fechaReg.getTime());\r\n                                                            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n                                                            return diffDays;\r\n                                                        }\r\n                                                        return 0;\r\n                                                    })()}</span>\r\n                                                </li>\r\n                                                <li className=\"flex justify-between\">\r\n                                                    <span>üèÜ Tu ranking:</span>\r\n                                                    <span className=\"font-bold text-blue-600\">{(() => {\r\n                                                        const usersStr = localStorage.getItem(\"users\");\r\n                                                        if (usersStr && currentUser) {\r\n                                                            const usersArr = JSON.parse(usersStr);\r\n                                                            const usersWithPoints = usersArr.map((u: any) => ({\r\n                                                                ...u,\r\n                                                                puntosTotales: calcularPuntosTotales(u)\r\n                                                            }));\r\n                                                            const sorted = usersWithPoints.sort((a: any, b: any) => b.puntosTotales - a.puntosTotales);\r\n                                                            const position = sorted.findIndex((u: any) => u.nick === currentUser.nick) + 1;\r\n                                                            return position > 0 ? `#${position}` : '-';\r\n                                                        }\r\n                                                        return '-';\r\n                                                    })()}</span>\r\n                                                </li>\r\n                                            </ul>\r\n                                        </div>\r\n\r\n                                        {/* An√°lisis de Materias Premium */}\r\n                                        <div className=\"bg-gradient-to-br from-green-50 to-emerald-100 rounded-xl p-4\">\r\n                                            <h3 className=\"font-bold text-green-800 mb-3 text-center\">üìö An√°lisis por Materias</h3>\r\n                                            <ul className=\"space-y-2 text-sm\">\r\n                                                <li className=\"flex justify-between\">\r\n                                                    <span>üî¨ Matem√°ticas:</span>\r\n                                                    <span className=\"font-bold text-green-600\">{(() => {\r\n                                                        if (currentUser) {\r\n                                                            const puntos = parseInt(localStorage.getItem(`matematicas_${currentUser.nick}`) || '0', 10);\r\n                                                            const nivel = Math.floor(puntos / 5) + 1;\r\n                                                            return `Nivel ${nivel}`;\r\n                                                        }\r\n                                                        return 'Nivel 1';\r\n                                                    })()}</span>\r\n                                                </li>\r\n                                                <li className=\"flex justify-between\">\r\n                                                    <span>üìñ Lenguaje:</span>\r\n                                                    <span className=\"font-bold text-green-600\">{(() => {\r\n                                                        if (currentUser) {\r\n                                                            const puntos = parseInt(localStorage.getItem(`lenguaje_${currentUser.nick}`) || '0', 10);\r\n                                                            const nivel = Math.floor(puntos / 5) + 1;\r\n                                                            return `Nivel ${nivel}`;\r\n                                                        }\r\n                                                        return 'Nivel 1';\r\n                                                    })()}</span>\r\n                                                </li>\r\n                                                <li className=\"flex justify-between\">\r\n                                                    <span>üåç Geograf√≠a:</span>\r\n                                                    <span className=\"font-bold text-green-600\">{(() => {\r\n                                                        if (currentUser) {\r\n                                                            const puntos = parseInt(localStorage.getItem(`geografia_${currentUser.nick}`) || '0', 10);\r\n                                                            const nivel = Math.floor(puntos / 5) + 1;\r\n                                                            return `Nivel ${nivel}`;\r\n                                                        }\r\n                                                        return 'Nivel 1';\r\n                                                    })()}</span>\r\n                                                </li>\r\n                                                <li className=\"flex justify-between\">\r\n                                                    <span>üìö Historia:</span>\r\n                                                    <span className=\"font-bold text-green-600\">{(() => {\r\n                                                        if (currentUser) {\r\n                                                            const puntos = parseInt(localStorage.getItem(`historia_${currentUser.nick}`) || '0', 10);\r\n                                                            const nivel = Math.floor(puntos / 5) + 1;\r\n                                                            return `Nivel ${nivel}`;\r\n                                                        }\r\n                                                        return 'Nivel 1';\r\n                                                    })()}</span>\r\n                                                </li>\r\n                                                <li className=\"flex justify-between\">\r\n                                                    <span>üé® Tu fuerte:</span>\r\n                                                    <span className=\"font-bold text-green-600\">{(() => {\r\n                                                        if (currentUser) {\r\n                                                            const asignaturas = [\r\n                                                                { nombre: 'Matem√°ticas', puntos: parseInt(localStorage.getItem(`matematicas_${currentUser.nick}`) || '0', 10) },\r\n                                                                { nombre: 'Lenguaje', puntos: parseInt(localStorage.getItem(`lenguaje_${currentUser.nick}`) || '0', 10) },\r\n                                                                { nombre: 'Geograf√≠a', puntos: parseInt(localStorage.getItem(`geografia_${currentUser.nick}`) || '0', 10) },\r\n                                                                { nombre: 'Historia', puntos: parseInt(localStorage.getItem(`historia_${currentUser.nick}`) || '0', 10) },\r\n                                                                { nombre: 'Literatura', puntos: parseInt(localStorage.getItem(`literatura_${currentUser.nick}`) || '0', 10) },\r\n                                                                { nombre: 'Ingl√©s', puntos: parseInt(localStorage.getItem(`ingles_${currentUser.nick}`) || '0', 10) },\r\n                                                                { nombre: 'Naturaleza', puntos: parseInt(localStorage.getItem(`naturaleza_${currentUser.nick}`) || '0', 10) }\r\n                                                            ];\r\n                                                            const mejor = asignaturas.reduce((max, actual) => actual.puntos > max.puntos ? actual : max);\r\n                                                            return mejor.puntos > 0 ? mejor.nombre : 'Ninguna a√∫n';\r\n                                                        }\r\n                                                        return 'Ninguna a√∫n';\r\n                                                    })()}</span>\r\n                                                </li>\r\n                                            </ul>\r\n                                        </div>\r\n\r\n                                        {/* Logros y Proyecci√≥n Premium */}\r\n                                        <div className=\"bg-gradient-to-br from-purple-50 to-violet-100 rounded-xl p-4\">\r\n                                            <h3 className=\"font-bold text-purple-800 mb-3 text-center\">üéØ Logros y Proyecci√≥n</h3>\r\n                                            <ul className=\"space-y-2 text-sm\">\r\n                                                <li className=\"flex justify-between\">\r\n                                                    <span>üìà Crecimiento:</span>\r\n                                                    <span className=\"font-bold text-purple-600\">{(() => {\r\n                                                        if (currentUser) {\r\n                                                            const acertadas = currentUser.preguntasAcertadas || 0;\r\n                                                            const falladas = (currentUser.preguntasFalladas || 0) + parseInt(localStorage.getItem('falladas_' + currentUser.nick) || '0', 10);\r\n                                                            const total = acertadas + falladas;\r\n                                                            if (total > 0) {\r\n                                                                const precision = (acertadas / total) * 100;\r\n                                                                const crecimiento = Math.max(0, Math.floor(precision - 50));\r\n                                                                return `+${crecimiento}% sem.`;\r\n                                                            }\r\n                                                        }\r\n                                                        return '+0% sem.';\r\n                                                    })()}</span>\r\n                                                </li>\r\n                                                <li className=\"flex justify-between\">\r\n                                                    <span>üéØ Meta semanal:</span>\r\n                                                    <span className=\"font-bold text-purple-600\">{(() => {\r\n                                                        if (currentUser) {\r\n                                                            const acertadas = (currentUser.preguntasAcertadas || 0) + parseInt(localStorage.getItem('acertadas_' + currentUser.nick) || '0', 10);\r\n                                                            const falladas = (currentUser.preguntasFalladas || 0) + parseInt(localStorage.getItem('falladas_' + currentUser.nick) || '0', 10);\r\n                                                            const total = acertadas + falladas;\r\n                                                            if (total > 0) {\r\n                                                                const precision = (acertadas / total) * 100;\r\n                                                                return precision >= 75 ? '75% ‚úÖ' : `${precision.toFixed(1)}% ‚ùå`;\r\n                                                            }\r\n                                                        }\r\n                                                        return '0% ‚ùå';\r\n                                                    })()}</span>\r\n                                                </li>\r\n                                                <li className=\"flex justify-between\">\r\n                                                    <span>‚≠ê Pr√≥ximo nivel:</span>\r\n                                                    <span className=\"font-bold text-purple-600\">{(() => {\r\n                                                        if (currentUser) {\r\n                                                            const puntosActuales = calcularPuntosTotales(currentUser);\r\n                                                            const nivelActual = Math.floor(puntosActuales / 100);\r\n                                                            const puntosParaSiguiente = ((nivelActual + 1) * 100) - puntosActuales;\r\n                                                            return `${puntosParaSiguiente} pts`;\r\n                                                        }\r\n                                                        return '100 pts';\r\n                                                    })()}</span>\r\n                                                </li>\r\n                                            </ul>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Gr√°fico de Progreso Premium */}\r\n                                    <div className=\"mt-6 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4\">\r\n                                        <h3 className=\"font-bold text-indigo-800 mb-3 text-center\">üìä Gr√°fico de Progreso Semanal</h3>\r\n                                        <div className=\"flex items-end justify-between h-32 gap-2\">\r\n                                            {[...Array(7)].map((_, i) => {\r\n                                                const dayActivities = (() => {\r\n                                                    if (currentUser) {\r\n                                                        const acertadas = parseInt(localStorage.getItem('acertadas_' + currentUser.nick) || '0', 10);\r\n                                                        const falladas = parseInt(localStorage.getItem('falladas_' + currentUser.nick) || '0', 10);\r\n                                                        const total = acertadas + falladas;\r\n\r\n                                                        // Simular actividad distribuida a lo largo de la semana\r\n                                                        const baseActivity = Math.floor(total / 7);\r\n                                                        const variation = Math.floor(Math.random() * 5) - 2; // -2 a +2\r\n                                                        return Math.max(0, baseActivity + variation);\r\n                                                    }\r\n                                                    return Math.floor(Math.random() * 5) + 1;\r\n                                                })();\r\n\r\n                                                const maxHeight = 25; // altura m√°xima esperada\r\n                                                const height = Math.max(20, Math.min(100, (dayActivities / maxHeight) * 80 + 20));\r\n                                                const day = ['L', 'M', 'X', 'J', 'V', 'S', 'D'][i];\r\n                                                const isToday = i === new Date().getDay() - 1 || (new Date().getDay() === 0 && i === 6);\r\n\r\n                                                return (\r\n                                                    <div key={i} className=\"flex flex-col items-center\">\r\n                                                        <div\r\n                                                            className={`w-8 rounded-t-md ${isToday ? 'bg-gradient-to-t from-orange-500 to-red-500' : 'bg-gradient-to-t from-blue-500 to-purple-500'}`}\r\n                                                            style={{ height: `${height}%` }}\r\n                                                        ></div>\r\n                                                        <span className={`text-xs mt-1 font-semibold ${isToday ? 'text-orange-600' : 'text-indigo-600'}`}>\r\n                                                            {day}\r\n                                                        </span>\r\n                                                        <span className=\"text-xs text-gray-500\">\r\n                                                            {dayActivities}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                );\r\n                                            })}\r\n                                        </div>\r\n                                        <div className=\"text-center mt-3 text-sm text-indigo-600\">\r\n                                            üìà <strong>Tendencia:</strong> {(() => {\r\n                                                if (currentUser) {\r\n                                                    const acertadas = (currentUser.preguntasAcertadas || 0) + parseInt(localStorage.getItem('acertadas_' + currentUser.nick) || '0', 10);\r\n                                                    const falladas = (currentUser.preguntasFalladas || 0) + parseInt(localStorage.getItem('falladas_' + currentUser.nick) || '0', 10);\r\n                                                    const precision = falladas + acertadas > 0 ? (acertadas / (falladas + acertadas)) * 100 : 0;\r\n\r\n                                                    if (precision >= 80) return '¬°Excelente! Mant√©n este nivel de precisi√≥n.';\r\n                                                    if (precision >= 60) return '¬°Vas muy bien! Mant√©n el ritmo esta semana.';\r\n                                                    if (precision >= 40) return 'Buen progreso. ¬°Sigue practicando!';\r\n                                                    return 'Empezando bien. ¬°Cada respuesta cuenta!';\r\n                                                }\r\n                                                return '¬°Empieza tu aventura de aprendizaje!';\r\n                                            })()}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Comparativa Premium */}\r\n                                    <div className=\"mt-6 bg-gradient-to-r from-orange-50 to-red-50 rounded-xl p-4\">\r\n                                        <h3 className=\"font-bold text-orange-800 mb-3 text-center\">‚öîÔ∏è Tu Posici√≥n vs. Mejores</h3>\r\n                                        <div className=\"grid grid-cols-3 gap-4 text-center\">\r\n                                            <div className=\"bg-white rounded-lg p-3\">\r\n                                                <div className=\"text-2xl\">ü•á</div>\r\n                                                <div className=\"text-xs text-gray-600\">1¬∫ Lugar</div>\r\n                                                <div className=\"font-bold text-yellow-600\">{(() => {\r\n                                                    if (typeof window !== \"undefined\") {\r\n                                                        const users = JSON.parse(localStorage.getItem(\"users\") || \"[]\");\r\n                                                        if (users.length > 0) {\r\n                                                            const usersWithPoints = users.map((u: any) => ({\r\n                                                                ...u,\r\n                                                                puntosTotales: calcularPuntosTotales(u)\r\n                                                            }));\r\n                                                            const sorted = usersWithPoints.sort((a: any, b: any) => b.puntosTotales - a.puntosTotales);\r\n                                                            return sorted[0]?.puntosTotales || 0;\r\n                                                        }\r\n                                                    }\r\n                                                    return 0;\r\n                                                })()}</div>\r\n                                                <div className=\"text-xs text-gray-500\">{(() => {\r\n                                                    if (typeof window !== \"undefined\") {\r\n                                                        const users = JSON.parse(localStorage.getItem(\"users\") || \"[]\");\r\n                                                        if (users.length > 0) {\r\n                                                            const usersWithPoints = users.map((u: any) => ({\r\n                                                                ...u,\r\n                                                                puntosTotales: calcularPuntosTotales(u)\r\n                                                            }));\r\n                                                            const sorted = usersWithPoints.sort((a: any, b: any) => b.puntosTotales - a.puntosTotales);\r\n                                                            return sorted[0]?.nick || 'Nadie';\r\n                                                        }\r\n                                                    }\r\n                                                    return 'Nadie';\r\n                                                })()}</div>\r\n                                            </div>\r\n                                            <div className=\"bg-gradient-to-r from-blue-100 to-purple-100 rounded-lg p-3 border-2 border-blue-300\">\r\n                                                <div className=\"text-2xl\">üëë</div>\r\n                                                <div className=\"text-xs text-blue-600 font-bold\">T√ö</div>\r\n                                                <div className=\"font-bold text-blue-600\">{currentUser ? calcularPuntosTotales(currentUser) : 0}</div>\r\n                                                <div className=\"text-xs text-blue-500\">{(() => {\r\n                                                    if (typeof window !== \"undefined\" && currentUser) {\r\n                                                        const users = JSON.parse(localStorage.getItem(\"users\") || \"[]\");\r\n                                                        if (users.length > 0) {\r\n                                                            const usersWithPoints = users.map((u: any) => ({\r\n                                                                ...u,\r\n                                                                puntosTotales: calcularPuntosTotales(u)\r\n                                                            }));\r\n                                                            const sorted = usersWithPoints.sort((a: any, b: any) => b.puntosTotales - a.puntosTotales);\r\n                                                            const position = sorted.findIndex((u: any) => u.nick === currentUser.nick) + 1;\r\n                                                            return position > 0 ? `Posici√≥n #${position}` : 'Sin clasificar';\r\n                                                        }\r\n                                                    }\r\n                                                    return 'Sin clasificar';\r\n                                                })()}</div>\r\n                                            </div>\r\n                                            <div className=\"bg-white rounded-lg p-3\">\r\n                                                <div className=\"text-2xl\">üéØ</div>\r\n                                                <div className=\"text-xs text-gray-600\">Promedio</div>\r\n                                                <div className=\"font-bold text-gray-600\">{(() => {\r\n                                                    if (typeof window !== \"undefined\") {\r\n                                                        const users = JSON.parse(localStorage.getItem(\"users\") || \"[]\");\r\n                                                        if (users.length > 0) {\r\n                                                            const total = users.reduce((sum: number, u: any) => sum + calcularPuntosTotales(u), 0);\r\n                                                            return Math.floor(total / users.length);\r\n                                                        }\r\n                                                    }\r\n                                                    return 0;\r\n                                                })()}</div>\r\n                                                <div className=\"text-xs text-gray-500\">{(() => {\r\n                                                    if (typeof window !== \"undefined\") {\r\n                                                        const users = JSON.parse(localStorage.getItem(\"users\") || \"[]\");\r\n                                                        return `${users.length} usuarios`;\r\n                                                    }\r\n                                                    return '0 usuarios';\r\n                                                })()}</div>\r\n                                            </div>\r\n                                        </div>\r\n                                        {/* Indicador de diferencia con el promedio */}\r\n                                        <div className=\"mt-3 text-center text-sm\">\r\n                                            {(() => {\r\n                                                if (typeof window !== \"undefined\" && currentUser) {\r\n                                                    const users = JSON.parse(localStorage.getItem(\"users\") || \"[]\");\r\n                                                    if (users.length > 0) {\r\n                                                        const total = users.reduce((sum: number, u: any) => sum + calcularPuntosTotales(u), 0);\r\n                                                        const promedio = Math.floor(total / users.length);\r\n                                                        const tusPuntos = calcularPuntosTotales(currentUser);\r\n                                                        const diferencia = tusPuntos - promedio;\r\n\r\n                                                        if (diferencia > 0) {\r\n                                                            return <span className=\"text-green-600\">üìà +{diferencia} puntos sobre el promedio</span>;\r\n                                                        } else if (diferencia < 0) {\r\n                                                            return <span className=\"text-red-600\">üìâ {Math.abs(diferencia)} puntos bajo el promedio</span>;\r\n                                                        } else {\r\n                                                            return <span className=\"text-blue-600\">üéØ Exactamente en el promedio</span>;\r\n                                                        }\r\n                                                    }\r\n                                                }\r\n                                                return <span className=\"text-gray-500\">Sin datos para comparar</span>;\r\n                                            })()}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Bloque 3: Mejores estad√≠sticas y curiosidades */}\r\n                    <div className=\"bg-white rounded-lg shadow-md p-6 max-w-5xl mx-auto mt-8\" >\r\n                        <h2 className=\"text-lg font-bold mb-4 text-center\">Mejores estad√≠sticas</h2>\r\n                        <ul className=\"space-y-2 text-center\">\r\n                            <li><span className=\"mr-2 text-xl\">üìñ</span><b>Historia con m√°s likes:</b> {(() => {\r\n                                if (typeof window !== \"undefined\") {\r\n                                    const historiasStr = localStorage.getItem(\"historias\");\r\n                                    if (historiasStr) {\r\n                                        try {\r\n                                            const historiasArr = JSON.parse(historiasStr);\r\n                                            if (historiasArr.length === 0) return \"-\";\r\n                                            const top = historiasArr.reduce((max: any, h: any) => {\r\n                                                if ((h.likes || 0) > (max.likes || 0)) return h;\r\n                                                return max;\r\n                                            }, historiasArr[0]);\r\n                                            return (\r\n                                                <span>\r\n                                                    <b>{top.titulo}</b> por <b><NickLink nick={top.autor} /></b> <span className=\"text-pink-600\">‚ù§Ô∏è {top.likes || 0}</span>\r\n                                                </span>\r\n                                            );\r\n                                        } catch { return \"-\"; }\r\n                                    }\r\n                                }\r\n                                return \"-\";\r\n                            })()}</li>\r\n                            <li><span className=\"mr-2 text-xl\">üí¨</span><b>Historia m√°s comentada:</b> {(() => {\r\n                                if (typeof window !== \"undefined\") {\r\n                                    const historiasStr = localStorage.getItem(\"historias\");\r\n                                    if (historiasStr) {\r\n                                        try {\r\n                                            const historiasArr = JSON.parse(historiasStr);\r\n                                            if (historiasArr.length === 0) return \"-\";\r\n                                            const top = historiasArr.reduce((max: any, h: any) => {\r\n                                                const comentarios = h.comentarios ? h.comentarios.length : 0;\r\n                                                const maxComentarios = max.comentarios ? max.comentarios.length : 0;\r\n                                                if (comentarios > maxComentarios) return h;\r\n                                                return max;\r\n                                            }, historiasArr[0]);\r\n                                            return (\r\n                                                <span>\r\n                                                    <b>{top.titulo}</b> por <b><NickLink nick={top.autor} /></b> <span className=\"text-blue-600\">üí¨ {top.comentarios ? top.comentarios.length : 0}</span>\r\n                                                </span>\r\n                                            );\r\n                                        } catch { return \"-\"; }\r\n                                    }\r\n                                }\r\n                                return \"-\";\r\n                            })()}</li>\r\n                            <li><span className=\"mr-2 text-xl\">üè´</span><b>Centro con m√°s historias creadas:</b> {(() => {\r\n                                if (typeof window !== \"undefined\") {\r\n                                    const historiasStr = localStorage.getItem(\"historias\");\r\n                                    const usersStr = localStorage.getItem(\"users\");\r\n                                    if (historiasStr && usersStr) {\r\n                                        try {\r\n                                            const historiasArr = JSON.parse(historiasStr);\r\n                                            const usersArr = JSON.parse(usersStr);\r\n                                            if (historiasArr.length === 0 || usersArr.length === 0) return \"-\";\r\n                                            const nickToCentro: Record<string, string> = {};\r\n                                            usersArr.forEach((u: any) => {\r\n                                                if (u.nick && u.centro) {\r\n                                                    nickToCentro[u.nick] = u.centro;\r\n                                                }\r\n                                            });\r\n                                            const historiasPorCentro: Record<string, number> = {};\r\n                                            historiasArr.forEach((h: any) => {\r\n                                                const centro = h.centro || nickToCentro[h.autor] || null;\r\n                                                if (centro) {\r\n                                                    historiasPorCentro[centro] = (historiasPorCentro[centro] || 0) + 1;\r\n                                                }\r\n                                            });\r\n                                            const top = Object.entries(historiasPorCentro).sort((a, b) => b[1] - a[1])[0];\r\n                                            if (!top) return \"-\";\r\n                                            return (\r\n                                                <span>\r\n                                                    <b>{top[0]}</b> <span className=\"text-purple-600\">üè´ {top[1]}</span>\r\n                                                </span>\r\n                                            );\r\n                                        } catch { return <span>-</span>; }\r\n                                    }\r\n                                }\r\n                                return \"-\";\r\n                            })()}</li>\r\n                            <li><span className=\"mr-2 text-xl\">üè´</span><b>Centro Escolar con m√°s usuarios activos:</b> {(() => {\r\n                                if (typeof window !== \"undefined\") {\r\n                                    const usersStr = localStorage.getItem(\"users\");\r\n                                    if (usersStr) {\r\n                                        try {\r\n                                            const usersArr = JSON.parse(usersStr);\r\n                                            if (usersArr.length === 0) return \"-\";\r\n                                            const usuariosPorCentro: Record<string, number> = {};\r\n                                            usersArr.forEach((u: any) => {\r\n                                                if (u.centro) {\r\n                                                    usuariosPorCentro[u.centro] = (usuariosPorCentro[u.centro] || 0) + 1;\r\n                                                }\r\n                                            });\r\n                                            const top = Object.entries(usuariosPorCentro).sort((a, b) => b[1] - a[1])[0];\r\n                                            if (!top) return \"-\";\r\n                                            return (\r\n                                                <span>\r\n                                                    <b>{top[0]}</b> <span className=\"text-blue-600\">üè´ {top[1]}</span>\r\n                                                </span>\r\n                                            );\r\n                                        } catch { return \"-\"; }\r\n                                    }\r\n                                }\r\n                                return \"-\";\r\n                            })()}</li>\r\n                        </ul>\r\n                    </div >\r\n                </>\r\n            )}\r\n        </div >\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}